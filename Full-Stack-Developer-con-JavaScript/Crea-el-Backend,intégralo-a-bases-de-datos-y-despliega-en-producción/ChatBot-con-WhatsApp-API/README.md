# Curso de ChatBot con WhatsApp API

## Tabla de Contenido<!-- omit in toc -->

- [Implementación de Chatbots con API de WhatsApp Business](#implementación-de-chatbots-con-api-de-whatsapp-business)
  - [¿Por qué elegir WhatsApp para conectar con tu audiencia?](#por-qué-elegir-whatsapp-para-conectar-con-tu-audiencia)
  - [¿Cómo puede la API de WhatsApp Business potenciar tu negocio?](#cómo-puede-la-api-de-whatsapp-business-potenciar-tu-negocio)
  - [¿Cómo está siendo usada la API de WhatsApp por empresas de diversos sectores?](#cómo-está-siendo-usada-la-api-de-whatsapp-por-empresas-de-diversos-sectores)
  - [¿Qué se aprende en un curso de integración de la API de WhatsApp Business?](#qué-se-aprende-en-un-curso-de-integración-de-la-api-de-whatsapp-business)
  - [¿Cómo funciona un chatbot de ejemplo en WhatsApp?](#cómo-funciona-un-chatbot-de-ejemplo-en-whatsapp)
- [API de WhatsApp Business: Integraciones y Comunicación Masiva](#api-de-whatsapp-business-integraciones-y-comunicación-masiva)
  - [¿Qué es WhatsApp Personal y cuál es su rol en los negocios?](#qué-es-whatsapp-personal-y-cuál-es-su-rol-en-los-negocios)
  - [¿Cómo beneficia WhatsApp Business a los pequeños y medianos negocios?](#cómo-beneficia-whatsapp-business-a-los-pequeños-y-medianos-negocios)
  - [¿Qué es la API de WhatsApp y por qué es ideal para grandes empresas?](#qué-es-la-api-de-whatsapp-y-por-qué-es-ideal-para-grandes-empresas)
- [Registro y Uso de Herramientas Meta para Desarrolladores](#registro-y-uso-de-herramientas-meta-para-desarrolladores)
  - [¿Cómo comenzar con el desarrollo en Meta for Developers?](#cómo-comenzar-con-el-desarrollo-en-meta-for-developers)
  - [¿Cómo registrarse en Meta for Developers?](#cómo-registrarse-en-meta-for-developers)
  - [¿Qué recursos están disponibles para los desarrolladores?](#qué-recursos-están-disponibles-para-los-desarrolladores)
  - [¿Cómo aplicar el conocimiento en un caso práctico?](#cómo-aplicar-el-conocimiento-en-un-caso-práctico)
- [Creación de aplicaciones con la API de WhatsApp para negocios](#creación-de-aplicaciones-con-la-api-de-whatsapp-para-negocios)
  - [¿Cómo puedo crear mi primera aplicación con una cuenta de desarrollador en Meta?](#cómo-puedo-crear-mi-primera-aplicación-con-una-cuenta-de-desarrollador-en-meta)
  - [¿Qué debo considerar al seleccionar el tipo de aplicación?](#qué-debo-considerar-al-seleccionar-el-tipo-de-aplicación)
  - [¿Cómo defino el tipo de empresa y nombre de la aplicación?](#cómo-defino-el-tipo-de-empresa-y-nombre-de-la-aplicación)
- [Configuración e Implementación de la API de WhatsApp Business](#configuración-e-implementación-de-la-api-de-whatsapp-business)
  - [¿Por qué es importante entender la documentación de la API de WhatsApp?](#por-qué-es-importante-entender-la-documentación-de-la-api-de-whatsapp)
  - [¿Cómo configurar una aplicación con la API de WhatsApp?](#cómo-configurar-una-aplicación-con-la-api-de-whatsapp)
  - [¿Cuáles son los elementos clave para implementar la API de WhatsApp?](#cuáles-son-los-elementos-clave-para-implementar-la-api-de-whatsapp)
  - [¿Cómo mejorar la integración con WhatsApp?](#cómo-mejorar-la-integración-con-whatsapp)
  - [¿Cómo gestionar los recursos para el uso masivo?](#cómo-gestionar-los-recursos-para-el-uso-masivo)
- [Configuración de Mensajería con API de WhatsApp para Veterinaria](#configuración-de-mensajería-con-api-de-whatsapp-para-veterinaria)
  - [¿Cómo configurar un token de acceso en WhatsApp para pruebas?](#cómo-configurar-un-token-de-acceso-en-whatsapp-para-pruebas)
  - [¿Cómo gestionar números y contactos para la aplicación?](#cómo-gestionar-números-y-contactos-para-la-aplicación)
  - [¿Cómo probar la API de WhatsApp?](#cómo-probar-la-api-de-whatsapp)
- [Integración de mensajes y recursos en Postman](#integración-de-mensajes-y-recursos-en-postman)
  - [¿Cómo utilizar la API de WhatsApp en Postman?](#cómo-utilizar-la-api-de-whatsapp-en-postman)
  - [¿Qué es Postman y para qué sirve?](#qué-es-postman-y-para-qué-sirve)
  - [¿Cómo configurar Postman para usar la API de WhatsApp?](#cómo-configurar-postman-para-usar-la-api-de-whatsapp)
  - [¿Cómo enviar un mensaje de prueba?](#cómo-enviar-un-mensaje-de-prueba)
  - [¿Cómo entender errores comunes en Postman?](#cómo-entender-errores-comunes-en-postman)
  - [¿Qué sigue después de la configuración?](#qué-sigue-después-de-la-configuración)
- [Configuración de un Servidor con Express y GitHub para Veterinaria](#configuración-de-un-servidor-con-express-y-github-para-veterinaria)
  - [¿Cómo organizar la estructura de carpetas para el proyecto?](#cómo-organizar-la-estructura-de-carpetas-para-el-proyecto)
  - [¿Cómo iniciar el repositorio de Git y la configuración de NPM?](#cómo-iniciar-el-repositorio-de-git-y-la-configuración-de-npm)
  - [¿Cuáles son las dependencias necesarias para el proyecto?](#cuáles-son-las-dependencias-necesarias-para-el-proyecto)
  - [¿Cómo organizar el editor de código?](#cómo-organizar-el-editor-de-código)
- [Configuración de Webhook para API de WhatsApp con Node.js](#configuración-de-webhook-para-api-de-whatsapp-con-nodejs)
  - [¿Cómo configurar el servidor de Node.js para WhatsApp API?](#cómo-configurar-el-servidor-de-nodejs-para-whatsapp-api)
  - [¿Cómo implementar el código de conexión y manejo de solicitudes?](#cómo-implementar-el-código-de-conexión-y-manejo-de-solicitudes)
  - [¿Cómo realizar pruebas locales y públicas?](#cómo-realizar-pruebas-locales-y-públicas)
  - [¿Cómo probar y depurar la integración?](#cómo-probar-y-depurar-la-integración)
- [Arquitectura MVC para Escalabilidad en Bots de Mensajería](#arquitectura-mvc-para-escalabilidad-en-bots-de-mensajería)
  - [¿Por qué es importante dividir el código en módulos?](#por-qué-es-importante-dividir-el-código-en-módulos)
  - [¿Cómo se organiza la estructura del bot?](#cómo-se-organiza-la-estructura-del-bot)
  - [¿Qué papel juegan los webhooks en esta configuración?](#qué-papel-juegan-los-webhooks-en-esta-configuración)
  - [¿Qué aporta la clase WhatsApp Service?](#qué-aporta-la-clase-whatsapp-service)
  - [¿Cómo contribuye esta arquitectura al trabajo en equipo?](#cómo-contribuye-esta-arquitectura-al-trabajo-en-equipo)
  - [¿Cómo se gestiona la inicialización de la aplicación?](#cómo-se-gestiona-la-inicialización-de-la-aplicación)
- [Conceptos básicos de validación de mensajes en programación](#conceptos-básicos-de-validación-de-mensajes-en-programación)
  - [¿Cómo personalizar la respuesta de un bot para identificar al usuario?](#cómo-personalizar-la-respuesta-de-un-bot-para-identificar-al-usuario)
  - [¿Cómo configurar la lógica de identificación en el controller?](#cómo-configurar-la-lógica-de-identificación-en-el-controller)
  - [¿Cómo realizar un reconocimiento de saludos?](#cómo-realizar-un-reconocimiento-de-saludos)
  - [¿Cómo enviar un mensaje de bienvenida personalizado?](#cómo-enviar-un-mensaje-de-bienvenida-personalizado)
  - [¿Cómo configurar la arquitectura y probar la lógica del bot?](#cómo-configurar-la-arquitectura-y-probar-la-lógica-del-bot)
- [Saludo Personalizado con Nombre desde WhatsApp](#saludo-personalizado-con-nombre-desde-whatsapp)
  - [¿Cómo personalizar el saludo de bienvenida de un bot?](#cómo-personalizar-el-saludo-de-bienvenida-de-un-bot)
  - [¿Cómo obtener el nombre del usuario?](#cómo-obtener-el-nombre-del-usuario)
  - [¿Cómo implementar un mensaje de saludo personalizado?](#cómo-implementar-un-mensaje-de-saludo-personalizado)
  - [¿Qué hacer cuando el nombre es un nombre completo?](#qué-hacer-cuando-el-nombre-es-un-nombre-completo)
- [Menús interactivos en WhatsApp: guía para bots con Postman y API](#menús-interactivos-en-whatsapp-guía-para-bots-con-postman-y-api)
  - [¿Cómo configurar el flujo de mensajes para iniciar la conversación?](#cómo-configurar-el-flujo-de-mensajes-para-iniciar-la-conversación)
  - [¿Cómo crear un menú de opciones en WhatsApp?](#cómo-crear-un-menú-de-opciones-en-whatsapp)
  - [Pasos básicos en Postman](#pasos-básicos-en-postman)
  - [¿Cómo implementar la lógica en el código del bot?](#cómo-implementar-la-lógica-en-el-código-del-bot)
  - [¿Cómo personalizar y extender el flujo de interacción?](#cómo-personalizar-y-extender-el-flujo-de-interacción)
  - [Consideraciones para un flujo optimizado](#consideraciones-para-un-flujo-optimizado)
- [Manejo de Interacciones en Bot de WhatsApp con JavaScript](#manejo-de-interacciones-en-bot-de-whatsapp-con-javascript)
  - [¿Cómo capturar la interacción del usuario con botones?](#cómo-capturar-la-interacción-del-usuario-con-botones)
  - [¿Cómo procesar la opción seleccionada?](#cómo-procesar-la-opción-seleccionada)
  - [¿Cómo enviar respuestas según la lógica definida?](#cómo-enviar-respuestas-según-la-lógica-definida)
  - [Manejo de errores: ¿qué hacer si algo falla?](#manejo-de-errores-qué-hacer-si-algo-falla)
  - [¿Cómo mejorar la funcionalidad del bot?](#cómo-mejorar-la-funcionalidad-del-bot)
- [Envío de Archivos Multimedia con API de WhatsApp](#envío-de-archivos-multimedia-con-api-de-whatsapp)
  - [¿Cómo enviar archivos multimedia en WhatsApp?](#cómo-enviar-archivos-multimedia-en-whatsapp)
  - [¿Cuáles formatos de archivos se pueden enviar?](#cuáles-formatos-de-archivos-se-pueden-enviar)
  - [¿Cómo programar la lógica para enviar estos archivos?](#cómo-programar-la-lógica-para-enviar-estos-archivos)
  - [¿Cómo manejar errores en el envío de archivos?](#cómo-manejar-errores-en-el-envío-de-archivos)
  - [¿Qué importancia tiene el flujo de envío en una aplicación?](#qué-importancia-tiene-el-flujo-de-envío-en-una-aplicación)
- [Uso de WhatsApp para Envío de Mensajes Multimedia](#uso-de-whatsapp-para-envío-de-mensajes-multimedia)
  - [¿Cómo integrar el envío de mensajes multimedia en una aplicación?](#cómo-integrar-el-envío-de-mensajes-multimedia-en-una-aplicación)
  - [¿Cómo configurar el flujo para enviar medios?](#cómo-configurar-el-flujo-para-enviar-medios)
  - [¿Cómo se estructura el código para diferentes tipos de medios?](#cómo-se-estructura-el-código-para-diferentes-tipos-de-medios)
  - [¿Cuáles son las prácticas recomendadas para el manejo de archivos multimedia?](#cuáles-son-las-prácticas-recomendadas-para-el-manejo-de-archivos-multimedia)
  - [¿Cómo hacer los envíos más dinámicos?](#cómo-hacer-los-envíos-más-dinámicos)
  - [¿Qué desafíos se presentan en la implementación?](#qué-desafíos-se-presentan-en-la-implementación)
  - [¿Qué mejoras sugieres para el flujo de trabajo?](#qué-mejoras-sugieres-para-el-flujo-de-trabajo)
- [Flujo Completo para Agendar Citas en un Bot de Mensajería](#flujo-completo-para-agendar-citas-en-un-bot-de-mensajería)
  - [¿Cómo crear un flujo de agenda de citas en un bot?](#cómo-crear-un-flujo-de-agenda-de-citas-en-un-bot)
  - [¿Qué es un constructor y para qué se utiliza en este flujo?](#qué-es-un-constructor-y-para-qué-se-utiliza-en-este-flujo)
  - [¿Cómo manejamos el estado del flujo con un switch?](#cómo-manejamos-el-estado-del-flujo-con-un-switch)
  - [¿Cómo inicializar el flujo y enviar mensajes?](#cómo-inicializar-el-flujo-y-enviar-mensajes)
  - [¿Qué errores comunes podemos encontrar y cómo solucionarlos?](#qué-errores-comunes-podemos-encontrar-y-cómo-solucionarlos)
  - [¿Cómo probar el flujo completo?](#cómo-probar-el-flujo-completo)
- [Manejo de Citas para Mascotas: Registro y Confirmación](#manejo-de-citas-para-mascotas-registro-y-confirmación)
  - [¿Cómo se puede gestionar un flujo de citas médicas para mascotas en una aplicación?](#cómo-se-puede-gestionar-un-flujo-de-citas-médicas-para-mascotas-en-una-aplicación)
  - [¿Cuál es la lógica que sustenta un flujo de citas?](#cuál-es-la-lógica-que-sustenta-un-flujo-de-citas)
  - [¿Cómo se construye un mensaje de confirmación robusto?](#cómo-se-construye-un-mensaje-de-confirmación-robusto)
  - [¿Cómo se implementa y valida este flujo?](#cómo-se-implementa-y-valida-este-flujo)
  - [¿Dónde podríamos almacenar esta información?](#dónde-podríamos-almacenar-esta-información)
- [Integración de Google Sheets API para Guardar Datos del Bot](#integración-de-google-sheets-api-para-guardar-datos-del-bot)
  - [¿Cómo integrar nuestro bot con Google Sheets?](#cómo-integrar-nuestro-bot-con-google-sheets)
  - [¿Qué necesitamos para comenzar con la API de Google Sheets?](#qué-necesitamos-para-comenzar-con-la-api-de-google-sheets)
  - [¿Cómo obtener las credenciales necesarias?](#cómo-obtener-las-credenciales-necesarias)
  - [¿Cómo configurar Google Sheets para recibir datos?](#cómo-configurar-google-sheets-para-recibir-datos)
- [Integración de Google Sheets con Node.js para Reservas Automáticas](#integración-de-google-sheets-con-nodejs-para-reservas-automáticas)
  - [¿Cómo integrarse con la API de Google Sheets?](#cómo-integrarse-con-la-api-de-google-sheets)
  - [¿Cómo se instala la dependencia Google APIs?](#cómo-se-instala-la-dependencia-google-apis)
  - [¿Cuál es la lógica básica de comunicación con la API?](#cuál-es-la-lógica-básica-de-comunicación-con-la-api)
  - [¿Cómo se realiza la autenticación y se utiliza el cliente autorizado?](#cómo-se-realiza-la-autenticación-y-se-utiliza-el-cliente-autorizado)
  - [¿Cómo integrar la lógica en la aplicación principal?](#cómo-integrar-la-lógica-en-la-aplicación-principal)
  - [¿Cuáles son los errores comunes y sus soluciones?](#cuáles-son-los-errores-comunes-y-sus-soluciones)
- [Integración de ChatGPT en Bots Veterinarios con API de OpenAI](#integración-de-chatgpt-en-bots-veterinarios-con-api-de-openai)
  - [¿Cómo conectar un bot con Chat GPT utilizando la API de OpenAI?](#cómo-conectar-un-bot-con-chat-gpt-utilizando-la-api-de-openai)
  - [¿Qué se necesita antes de comenzar?](#qué-se-necesita-antes-de-comenzar)
  - [¿Cómo instalar la dependencia de OpenAI?](#cómo-instalar-la-dependencia-de-openai)
  - [¿Cómo crear un archivo de servicio en Node.js?](#cómo-crear-un-archivo-de-servicio-en-nodejs)
  - [¿Cómo manejar las variables de entorno?](#cómo-manejar-las-variables-de-entorno)
  - [¿Cómo se integra el servicio en el flujo del bot?](#cómo-se-integra-el-servicio-en-el-flujo-del-bot)
- [Integración de ChatGPT en Flujo de Mensajería con WhatsApp](#integración-de-chatgpt-en-flujo-de-mensajería-con-whatsapp)
  - [¿Cómo integrar OpenAI Service con el flujo de un chatbot?](#cómo-integrar-openai-service-con-el-flujo-de-un-chatbot)
  - [¿Cómo inicializar el estado del asistente?](#cómo-inicializar-el-estado-del-asistente)
  - [¿Cómo detectar el estado del asistente?](#cómo-detectar-el-estado-del-asistente)
  - [¿Cómo manejar el flujo del asistente?](#cómo-manejar-el-flujo-del-asistente)
  - [¿Cómo enviar interacciones basadas en botones?](#cómo-enviar-interacciones-basadas-en-botones)
  - [¿Cómo probar y ajustar el flujo?](#cómo-probar-y-ajustar-el-flujo)
- [Envío de Contacto en Emergencias Veterinarias vía WhatsApp](#envío-de-contacto-en-emergencias-veterinarias-vía-whatsapp)
  - [¿Cómo integrar un contacto en el flujo de emergencias del bot de WhatsApp?](#cómo-integrar-un-contacto-en-el-flujo-de-emergencias-del-bot-de-whatsapp)
  - [¿Cómo configurar el flujo inicial en WhatsApp Service?](#cómo-configurar-el-flujo-inicial-en-whatsapp-service)
  - [¿Cómo personalizar el manejador de mensajes?](#cómo-personalizar-el-manejador-de-mensajes)
  - [¿Cómo mejorar la interacción del usuario con el menú del bot?](#cómo-mejorar-la-interacción-del-usuario-con-el-menú-del-bot)
  - [¿Qué errores comunes podemos encontrar al implementar este flujo?](#qué-errores-comunes-podemos-encontrar-al-implementar-este-flujo)
- [Validación de Menú en WhatsApp con IDs Estables](#validación-de-menú-en-whatsapp-con-ids-estables)
  - [¿Cómo se mejora la validación de opciones en un menú interactivo?](#cómo-se-mejora-la-validación-de-opciones-en-un-menú-interactivo)
  - [¿Qué son las IDs y cómo se utilizan?](#qué-son-las-ids-y-cómo-se-utilizan)
  - [¿Cómo se envía una ubicación usando la API de WhatsApp?](#cómo-se-envía-una-ubicación-usando-la-api-de-whatsapp)
  - [¿Cómo se construye el servicio de envío de ubicación?](#cómo-se-construye-el-servicio-de-envío-de-ubicación)
  - [¿Cómo completar y probar la integración del menú con WhatsApp?](#cómo-completar-y-probar-la-integración-del-menú-con-whatsapp)
  - [Implementación en el menú de opciones](#implementación-en-el-menú-de-opciones)
  - [Prueba de la aplicación](#prueba-de-la-aplicación)
- [Uso de Variables de Entorno y Mejora de Código en WhatsApp Service](#uso-de-variables-de-entorno-y-mejora-de-código-en-whatsapp-service)
  - [¿Cómo comenzamos organizando nuestro código?](#cómo-comenzamos-organizando-nuestro-código)
  - [¿Qué elementos básicos necesitamos en el nuevo archivo?](#qué-elementos-básicos-necesitamos-en-el-nuevo-archivo)
  - [¿Cómo actualizamos el servicio de WhatsApp para utilizar esta lógica?](#cómo-actualizamos-el-servicio-de-whatsapp-para-utilizar-esta-lógica)
- [Despliegue de Bots de WhatsApp en Railway con Integración de GitHub](#despliegue-de-bots-de-whatsapp-en-railway-con-integración-de-github)
  - [¿Cómo llevar a producción un bot de WhatsApp?](#cómo-llevar-a-producción-un-bot-de-whatsapp)
  - [¿Qué plataformas son ideales para el despliegue?](#qué-plataformas-son-ideales-para-el-despliegue)
  - [¿Cómo gestionar las variables de entorno?](#cómo-gestionar-las-variables-de-entorno)
  - [¿Cómo asegurar que el despliegue funcione correctamente?](#cómo-asegurar-que-el-despliegue-funcione-correctamente)
    - [Verificación de URL](#verificación-de-url)
    - [Configuración en Meta](#configuración-en-meta)
      - [¿Cómo manejar cambios y ajustes tras el despliegue?](#cómo-manejar-cambios-y-ajustes-tras-el-despliegue)
      - [¿Cómo verificar el funcionamiento del bot después del despliegue?](#cómo-verificar-el-funcionamiento-del-bot-después-del-despliegue)
- [Publicación y configuración de aplicaciones con API de WhatsApp](#publicación-y-configuración-de-aplicaciones-con-api-de-whatsapp)
  - [¿Cómo publicar una aplicación en el dashboard de Meta?](#cómo-publicar-una-aplicación-en-el-dashboard-de-meta)
  - [¿Cuáles son los pasos para configurar el API de WhatsApp?](#cuáles-son-los-pasos-para-configurar-el-api-de-whatsapp)
  - [¿Cómo configurar métodos de pago adecuados?](#cómo-configurar-métodos-de-pago-adecuados)
  - [¿Qué otros aspectos administrativos se deben considerar?](#qué-otros-aspectos-administrativos-se-deben-considerar)
  - [¿Cómo se configuran las cuentas de WhatsApp Manager y las variables necesarias?](#cómo-se-configuran-las-cuentas-de-whatsapp-manager-y-las-variables-necesarias)
  - [¿Cómo realizar la prueba de la aplicación con los cambios implementados?](#cómo-realizar-la-prueba-de-la-aplicación-con-los-cambios-implementados)

## Implementación de Chatbots con API de WhatsApp Business

El marketing en aplicaciones de mensajería ha revolucionado la comunicación entre empresas y clientes, y WhatsApp lidera este cambio con una plataforma que ofrece una experiencia personalizada y global. Su API permite a las empresas aprovechar el alcance masivo y la preferencia de los usuarios por esta app, transformando las interacciones comerciales en conversaciones fluidas y efectivas.

### ¿Por qué elegir WhatsApp para conectar con tu audiencia?

- **Alcance masivo:** Con 2.2 mil millones de usuarios activos al mes, WhatsApp es una de las plataformas de comunicación más grandes y preferidas del mundo.
- **Engagement superior:** Las notificaciones de WhatsApp tienen una tasa de apertura del 98%, comparado con el 21% de los correos electrónicos. Además, los usuarios revisan la app en promedio 23 veces al día, lo que asegura visibilidad.
- **Preferencia del cliente:** El 85% de los consumidores prefiere comunicarse con las marcas mediante aplicaciones de mensajería, lo cual fortalece la lealtad y la confianza en la marca.

### ¿Cómo puede la API de WhatsApp Business potenciar tu negocio?

La API de WhatsApp Business permite a las empresas ofrecer una comunicación directa y automatizada a través de funciones como:

- **Notificaciones personalizadas:** Desde recordatorios de entrega hasta alertas de descuentos, la API facilita notificaciones relevantes y oportunas.
- **Soporte al cliente:** Las consultas sobre productos, servicios o agendamientos pueden manejarse de manera inmediata, mejorando la experiencia del cliente.
- **Automatización con IA:** Implementar inteligencia artificial permite responder preguntas frecuentes, ofrecer recomendaciones y resolver problemas sin intervención humana.

### ¿Cómo está siendo usada la API de WhatsApp por empresas de diversos sectores?

Ejemplos como el de Rappi, que notifica descuentos o promociones, demuestran el impacto de esta herramienta en la fidelización de clientes. Con 100 millones de mensajes enviados diariamente a través de la plataforma, las empresas pueden no solo escalar la comunicación, sino también fortalecer la relación con sus clientes a largo plazo.

### ¿Qué se aprende en un curso de integración de la API de WhatsApp Business?

Un curso enfocado en la API de WhatsApp Business suele cubrir la creación de chatbots y procesos automatizados que simplifican la comunicación con los clientes. Algunas lecciones clave incluyen:

- **Diseño de un chatbot:** Un asistente virtual que responde consultas comunes y facilita agendamientos.
- **Configuración de inteligencia artificial:** Procesos para que el bot pueda ofrecer recomendaciones basadas en inteligencia artificial.
- **Opciones de personalización:** Enviar mensajes de bienvenida, mostrar un menú de opciones para el cliente y proveer información relevante como ubicación y contacto.

### ¿Cómo funciona un chatbot de ejemplo en WhatsApp?

Un ejemplo práctico es el chatbot de **MedPet**, que responde en tiempo real a consultas veterinarias. Al enviar un mensaje, el usuario recibe una respuesta personalizada y puede acceder a un menú de opciones. Si un usuario pregunta “¿Mi perro no quiere comer, debo llevarlo de emergencia?”, el chatbot analiza y responde con sugerencias y recomendaciones, siempre disponible las 24 horas.

[🡡 volver al inicio](#tabla-de-contenido)

## API de WhatsApp Business: Integraciones y Comunicación Masiva

Antes de profundizar en la API de WhatsApp, conviene entender las versiones de esta herramienta que se pueden emplear para potenciar la comunicación empresarial. WhatsApp Personal y WhatsApp Business son opciones iniciales de gran utilidad, pero la API de WhatsApp permite alcanzar un nivel de automatización e interacción masiva, ideal para empresas que buscan escalar sus servicios.

### ¿Qué es WhatsApp Personal y cuál es su rol en los negocios?

WhatsApp Personal es la versión más conocida y usada globalmente. Es la aplicación de uso cotidiano para mensajería personal, y aunque no es la opción principal para empresas, sigue siendo útil en este contexto, pues muchos clientes prefieren interactuar de forma directa. En este curso, la usaremos para probar los flujos que crearemos con la API de WhatsApp.

### ¿Cómo beneficia WhatsApp Business a los pequeños y medianos negocios?

WhatsApp Business es ideal para pequeñas y medianas empresas. Ofrece:

- Integración de herramientas para gestionar flujos de venta.
- Etiquetado de clientes para segmentación.
- Capacidad de lanzar campañas y mostrar productos.
- Posibilidad de manejar hasta cuatro agentes en una misma cuenta para interacción con clientes.

Aunque útil, esta versión limita la interacción a un modelo uno a uno y no soporta volúmenes masivos de mensajería ni flujos automatizados.

### ¿Qué es la API de WhatsApp y por qué es ideal para grandes empresas?

La API de WhatsApp permite crear flujos avanzados e interacciones programables a gran escala. Sus principales ventajas incluyen:

- Automatización de respuestas frecuentes mediante chatbots.
- Campañas de marketing de alta apertura, con capacidad para enviar miles de mensajes a clientes suscritos.
- Integración con CRMs y sistemas de gestión para manejar grandes volúmenes de interacciones.
- Opciones para envíos masivos de notificaciones, como actualizaciones de entrega de pedidos.

Con esta API, las empresas pueden reducir la dependencia en agentes humanos, permitiendo que los chatbots gestionen las interacciones frecuentes, mejorando la eficiencia y la experiencia del cliente.

[🡡 volver al inicio](#tabla-de-contenido)

## Registro y Uso de Herramientas Meta para Desarrolladores

### ¿Cómo comenzar con el desarrollo en Meta for Developers?

Antes de que puedas sumergirte en el mundo del desarrollo con Meta, es imprescindible contar con una cuenta de Facebook. Este es el primer paso para acceder al vasto ecosistema de herramientas y plataformas que Meta ofrece. Una vez completado este sencillo paso, dirígete a developers.meta.com para explorar todas las posibilidades, no solo para WhatsApp, sino también para otras plataformas como Instagram y Messenger.

El sitio está repleto de documentación, las últimas noticias y numerosos recursos para ayudarte en tu camino como desarrollador. Por tanto, te recomendamos dedicar un tiempo a explorar toda esta información antes de proceder a registrar tu cuenta.

### ¿Cómo registrarse en Meta for Developers?

El proceso de registro comienza dentro del apartado de WhatsApp en el sitio de Meta Developers. Allí encontrarás una opción llamada 'Empezar' en la parte superior derecha. Al hacer clic, tendrás la oportunidad de crear una cuenta en Meta for Developers. Aquí te proporcionamos los pasos esenciales:

1. Iniciar sesión con Facebook: Utiliza tu cuenta de Facebook para registrarte.
2. Confirmar correo electrónico: Proveerás el correo asociado a tu cuenta y lo confirmarás.
3. Completar una encuesta: Deberás llenar un pequeño cuestionario donde describes tus habilidades como desarrollador de software.
4. Acceso a recursos: Una vez registrado, podrás acceder a la API y demás herramientas que Meta pone a disposición.

Además, se recomienda unirse a la comunidad de desarrolladores de Meta en Facebook, donde puedes interactuar con otros profesionales, compartir conocimientos y resolver dudas.

### ¿Qué recursos están disponibles para los desarrolladores?

Una de las grandes ventajas de ser parte de la comunidad de Meta for Developers es el acceso a una variedad de recursos que se ofrecen:

- **Documentación y guías:** Asegúrate de revisar toda la documentación disponible que proporciona instrucciones detalladas sobre cómo utilizar las distintas APIs y SDKs.
- **Grupos y comunidades:** Únete a grupos en Facebook donde podrás conectar con otros desarrolladores y compartir experiencias.
- **Repositorio de GitHub:** Meta dispone de un repositorio en GitHub repleto de ejemplos prácticos, librerías y recursos útiles que puedes integrar en tus proyectos.
- **Soporte y ayuda:** Aprovecha el sistema de ayuda y asistencia técnica para resolver cualquier duda o problema que puedas tener.

Estos recursos son cruciales para el éxito del desarrollo de tus aplicaciones y para mantenerte al día con las últimas tendencias y tecnologías que Meta ofrece.

### ¿Cómo aplicar el conocimiento en un caso práctico?

Para demostrar el potencial de las herramientas de Meta, se puede desarrollar un proyecto que automatice el proceso de gestión de citas y consultas en una veterinaria. Este tipo de proyecto te permitirá:

- **Desarrollar habilidades prácticas:** Aplicarás tus conocimientos de programación para construir una aplicación funcional.
- **Integrar múltiples servicios:** Podrás utilizar varias APIs de Meta para crear una experiencia de usuario integrada.
- **Resolver problemas del mundo real:** Al abordar un caso de uso específico, como el de una veterinaria, estarás solucionando problemas reales y ayudando a optimizar los procesos existentes.

Con estos pasos y recursos, te invitamos a que empieces a explorar y construir grandes aplicaciones utilizando la plataforma de Meta. ¡El conocimiento está al alcance y solo necesitas comenzar!

[🡡 volver al inicio](#tabla-de-contenido)

## Creación de aplicaciones con la API de WhatsApp para negocios

### ¿Cómo puedo crear mi primera aplicación con una cuenta de desarrollador en Meta?

Crear tu primera aplicación utilizando una cuenta de desarrollador en Meta es un paso fundamental para integrar y optimizar soluciones, especialmente si deseas trabajar con recursos como la API de WhatsApp. En este proceso sencillo pero crucial, te guiaremos a través de los pasos esenciales. Comienza creando una aplicación en la interfaz que ya tienes configurada. Sigue las indicaciones proporcionadas por Meta, ya que te ayudarán a simplificar este proceso.

Meta te ofrece varias opciones para crear aplicaciones, cada una adecuada para diferentes propósitos y productos que ofrece esta plataforma, incluyendo WhatsApp, Instagram, Messenger, y más. Aunque el enfoque principal aquí será WhatsApp, es importante evaluar qué desees en tu aplicación antes de proceder. También es esencial considerar la creación de un portafolio empresarial. Aunque este paso no es un requisito inmediato para las pruebas, es aconsejable comenzar a pensar en su implementación para producción futura.

### ¿Qué debo considerar al seleccionar el tipo de aplicación?

Al seleccionar el tipo de aplicación, Meta te preguntará sobre qué deseas que haga tu aplicación. Ahí debes prestar mucha atención, ya que la elección determinará los recursos a los que tendrás acceso. Si estás interesado en negocios, busca la opción relacionada, ya que ahí podrás explorar la API de WhatsApp. Una vez que selecciones la opción adecuada para tus necesidades, podrás avanzar en el proceso de configuración.

### ¿Cómo defino el tipo de empresa y nombre de la aplicación?

Seleccionar el tipo de empresa es un paso relevante: ¿serás un consumidor o crearás aplicaciones y recursos para otras empresas? Esta decisión afectará las herramientas y APIs disponibles. Luego, deberás nombrar tu aplicación. En este ejemplo, el nombre elegido fue "Med Pet", una aplicación diseñada para una veterinaria. Este nombre representa el objetivo de la aplicación: mejorar la gestión de agendas, ubicaciones y consultas comunes con la API de WhatsApp.

#### ¿Qué pasos seguir después de crear la aplicación?

Una vez que hayas creado la aplicación, tu próxima tarea será validar tu correo electrónico, que puede ser el mismo asociado a tu cuenta o uno corporativo relevante para tu producto. Además, se te recordará sobre el portafolio empresarial, opcional al principio, pero crucial antes del despliegue masivo de la aplicación.

Al crear la aplicación, se te pedirá tu contraseña para continuar. Finalmente, accederás a un panel donde podrás manejar varios aspectos de tu aplicación:

- **Administración de roles:** asigna responsabilidades a miembros del equipo.
- **Configuraciones:** ajusta los parámetros técnicos.
- **Acciones requeridas y alertas:** mantente al tanto de los cambios y problemas.
- **Revisión para producción:** planifica cómo y cuándo lanzar tu aplicación al público.

### ¿Cómo prepararse para el siguiente paso?

Es fundamental familiarizarse con la documentación disponible en el panel de administración. Dedica tiempo a leer y comprender las características y elementos que enfrentarás. Esta lectura te permitirá planificar de forma efectiva la construcción y despliegue de tu aplicación.

[🡡 volver al inicio](#tabla-de-contenido)

## Configuración e Implementación de la API de WhatsApp Business

### ¿Por qué es importante entender la documentación de la API de WhatsApp?

Poner atención a los detalles y entender la documentación es clave para que un profesional crezca y se desarrolle. Cuando se trata de la API de WhatsApp, esta comprensión no solo te capacita para aprovechar todas sus posibilidades, sino que también te mantiene al día con las constantes mejoras y opciones nuevas que Meta añade. La API de WhatsApp es un recurso poderoso que puede transformar la forma en que las empresas interactúan con sus clientes, por lo que conocer cada detalle es crucial.

### ¿Cómo configurar una aplicación con la API de WhatsApp?

Configurar tu aplicación para usar la API de WhatsApp es el primer paso para explorar sus capacidades. Este proceso te permite trabajar con una misma aplicación para múltiples plataformas, como Instagram y Messenger, dependiendo de las necesidades de tu negocio. Sin embargo, para este caso, nos concentraremos en WhatsApp.

1. **Selecciona el apartado correspondiente al portafolio.** Este es un requisito esencial para acceder a la API. Aunque inicialmente utilice la configuración por defecto, eventualmente deberás configurarlo detalladamente para seguir avanzando en la aplicación.
2. **Sigue el inicio rápido.** Esta herramienta ofrece elementos esenciales como WhatsApp Business, configuración del SDK y Webhooks, entre otros, todos fundamentales para el progreso en el uso del producto.

### ¿Cuáles son los elementos clave para implementar la API de WhatsApp?

Al iniciar con la API de WhatsApp, es importante identificar y trabajar con varios elementos cruciales:

- **Generar un token de acceso:** Es el primer paso para la autenticación y uso seguro de la API.
- **Asignar un número de prueba:** Cabe mencionar que al inicio el número será temporal, de desarrollo, y solo podrá comunicarse con hasta cinco dispositivos registrados.
- **Identificador de Aplicación:** Este se usará y configurará en diferentes partes de la aplicación.

Estos recursos permiten la comunicación efectiva entre tu aplicación y el usuario final.

### ¿Cómo mejorar la integración con WhatsApp?

Para potenciar la aplicación y facilitar la integración, Meta proporciona herramientas como Postman para entender la documentación de manera detallada. Esta ayuda a comprender desde el envío de mensajes simples hasta el uso de plantillas de interacción robustas. Así mismo, la configuración de Webhooks construidos a través de código aporta notables beneficios para expandir las capacidades del usuario.

### ¿Cómo gestionar los recursos para el uso masivo?

Finalmente, cuando pases de un entorno de pruebas a producción, necesitarás adquirir un número real y configurar métodos de pago. Esto es esencial para escalar el uso y permitir la interacción masiva con los usuarios, superando las limitaciones de las pruebas. Al alcanzar esta fase, estarás listo para desplegar la aplicación y permitir el acceso a cualquier usuario interesado en un flujo de integración fluido.

[🡡 volver al inicio](#tabla-de-contenido)

## Configuración de Mensajería con API de WhatsApp para Veterinaria

### ¿Cómo configurar un token de acceso en WhatsApp para pruebas?

Para poder recibir mensajes en su aplicación mediante el número de pruebas proporcionado por Meta, es crucial iniciar este proceso configurando un token de acceso. A continuación, se detalla cómo hacerlo de manera efectiva:

1. **Genera un token de acceso:**

   - Haz clic en "Generar token de acceso".
   - Autoriza la generación del token con tu usuario y selecciona las opciones que permitirán compartir los permisos con las cuentas existentes.
   - Guardar los permisos es esencial para manejar WhatsApp y otorgar accesos necesarios.

2. **Token de duración temporal:**

   - El token generado tendrá una validez de 24 horas. Mientras desarrollas tu aplicación, necesitas generarlo continuamente.
   - Este token temporal es útil durante la fase de desarrollo hasta que esté lista la aplicación para revisión y publicación, donde se generará un token permanente.

3. **Guarda el token de acceso de manera segura:**
   - Asegúrate de copiar el token recién generado y guardarlo en un lugar seguro. Aunque es solo de pruebas, su conservación es importante.

### ¿Cómo gestionar números y contactos para la aplicación?

Una parte clave del desarrollo de la API de WhatsApp es administrar correctamente los números y contactos con los que interactuarás durante las pruebas. Esto se lleva a cabo siguiendo estos pasos:

1. **Asignación del número por Meta:**

   - Meta te asignará un número específico para comunicarte dentro de las pruebas.
   - Solo podrás interactuar con un máximo de cinco números diferentes registrados.

2. Agregar un número para comunicación:

   - Elije un número de WhatsApp normal o de business que estará presente en tus pruebas.
   - Conecta este número a través del cliente de WhatsApp (ejemplo, para macOS) para facilitar las pruebas de interacción con tu bot.

3. Limitaciones y recomendaciones para el número de pruebas:

   - El número asignado no permitiría generar discusiones masivas y se limita exclusivamente a los usuarios que registres para pruebas.

### ¿Cómo probar la API de WhatsApp?

Probar la API es fundamental para entender sus características y capacidades. Sigue estas etapas para llevar a cabo pruebas efectivas:

1. **Primeros pasos con el mensaje de prueba:**

   - Utiliza herramientas como Curl y GraphQL para interactuar inicialmente con la API y el token de autorización generado.
   - Envía tu primer mensaje para verificar la conexión entre tu número de pruebas y la aplicación.

2. Verificación de recepción de mensajes:

   - Confirma la recepción del mensaje en tu cuenta de WhatsApp personal. Se debe recibir el mensaje del número de pruebas proporcionado por Meta.

3. Configuración de flujo de prueba para la aplicación:

   - Prepárate para desarrollar la lógica necesaria, en este caso para una veterinaria llamada MedPet.
   - La prioridad es crear un flujo eficiente de servicios como bienvenida, programación de citas, consultas, e integración de inteligencia artificial.

Para maximizarlas capacidades de tu aplicación desde WhatsApp, asegúrate de contar con las herramientas necesarias como Visual Studio Code, una terminal y Postman, las cuales ayudarán en la construcción y prueba del bot, modelando así la experiencia del usuario final y resolviendo problemas comunes durante la fase de pruebas. Con esto, te alientamos a profundizar en estas herramientas, brindarte más conocimientos y afán de seguir aprendiendo para lograr todo el potencial de tu solución digital.

[🡡 volver al inicio](#tabla-de-contenido)

## Integración de mensajes y recursos en Postman

### ¿Cómo utilizar la API de WhatsApp en Postman?

Postman se presenta como una potente herramienta para entender cómo funciona la API de WhatsApp, también conocida como WhatsApp Cloud API, antes de dar los primeros pasos en el desarrollo. Esta clase se centra en su adecuada utilización para implementar los diferentes tipos de mensajes y recursos que ofrece para pruebas iniciales.

### ¿Qué es Postman y para qué sirve?

Postman es una plataforma esencial para el desarrollo de APIs. Facilita la comunicación y pruebas de API antes de codificar, lo que permite garantizar la calidad y funcionalidad de la aplicación que se desea desarrollar. Entre sus grandes ventajas, encontramos:

- **Documentación Extensa:** Postman ofrece documentación detallada sobre la API de WhatsApp, abarcando desde los básicos hasta casos complejos de uso.
- **Pruebas Antes de Codificar:** Con Postman, puedes simular el envío de mensajes y realizar configuraciones necesarias para asegurar que todo funcione correctamente antes de llevarlo a un entorno de producción.
- **Facilidad de Uso:** Su interfaz intuitiva permite a los desarrolladores, sin necesidad de profundos conocimientos previos, entender mejor cómo interactuar con la API.

### ¿Cómo configurar Postman para usar la API de WhatsApp?

La configuración empieza en Postman creando un espacio de trabajo dedicado. Aquí tienes un resumen de los pasos esenciales:

1. **Crear un Espacio de Trabajo:** Asigna un nombre identificativo, por ejemplo, “WhatsApp GNDX”, para almacenar la colección de la API.
2. **Copiar la Colección de la API:** Esto incluye toda la documentación y ejemplos necesarios para la integración.
3. **Configurar Identificadores y Variables:**
   - **ID de Teléfono:** El identificador del número que utilizarás debe incluir el código de país.
   - **Número de Versión:** Utiliza la versión proporcionada por Postman para tus pruebas iniciales.
   - **Token de Autorización:** Fundamental para autenticar tus solicitudes.

### ¿Cómo enviar un mensaje de prueba?

Con toda la configuración inicial lista, puedes proceder al envío de un mensaje de ejemplo. Sigue estos pasos:

- **Verifica la Configuración:** Asegúrate que todos los elementos clave están configurados (ID, número, token).
- **Envíar Mensaje:** Utiliza el ejemplo proporcionado en la colección de Postman para enviar un mensaje.
- **Revisa el Resultado:** La API debe proporcionar un ID y un estatus de éxito. Puedes verificar el envío revisando si el mensaje aparece en tu aplicación de WhatsApp.

### ¿Cómo entender errores comunes en Postman?

Familiarizarse con los mensajes de error en Postman es crucial:

- **Errores de Traducción:** Cambiar el template a un idioma incorrecto puede generar errores. Asegúrate de que el template exista en el idioma seleccionado.
- **Documentación y Ejemplos:** Recurre a la documentación disponible para entender y resolver problemas específicos que puedan surgir.

### ¿Qué sigue después de la configuración?

Una vez que domines el uso de Postman con la API de WhatsApp, el siguiente paso es integrar estas capacidades a tu aplicación, asegurando un flujo de trabajo eficiente. Utiliza los ejemplos y documentación para explorar más funcionalidades y personalizar las interacciones según los requerimientos específicos del proyecto, como el de una veterinaria en este caso.

Explora y experimenta. Con un entendimiento consolidado de las herramientas y configuraciones, estarás en una posición ventajosa para encarar exitosamente la implementación de esta API.

[🡡 volver al inicio](#tabla-de-contenido)

## Configuración de un Servidor con Express y GitHub para Veterinaria

Configurar el espacio de trabajo y preparar las herramientas iniciales es esencial para desarrollar aplicaciones eficientes y escalables. A continuación, te guiaré a través de los pasos para crear un servidor básico con Express, con recomendaciones para optimizar el flujo de trabajo en Node.js.

### ¿Cómo organizar la estructura de carpetas para el proyecto?

- **Directorio principal:** Crea una carpeta donde organizarás todos tus proyectos. Por ejemplo, si usas un directorio llamado dev, dentro puedes crear carpetas específicas para cada proyecto. Para este caso:
  - mkdir whatsapp (directorio raíz del proyecto)
  - Dentro de esta, mkdir med-pet, que será el espacio de trabajo de nuestra aplicación para una veterinaria.

### ¿Cómo iniciar el repositorio de Git y la configuración de NPM?

1. Inicializar Git: En la carpeta med-pet, ejecuta:

   ```bash
   git init
   ```

   Esto crea un repositorio Git para gestionar la evolución de tu proyecto y guardar los cambios localmente y en la nube.

2. Configurar NPM: Para instalar las dependencias de JavaScript, inicializa NPM con:

   ```bash
   npm init -y
   ```

   Este comando genera un archivo package.json con configuraciones iniciales.

### ¿Cuáles son las dependencias necesarias para el proyecto?

1. **Express:** Este framework facilita la creación de servidores HTTP:

   ```bash
   npm install express
   ```

2. **Axios:** Permite hacer peticiones HTTP hacia APIs externas:

   ```bash
   npm install axios
   ```

3. **Dotenv:** Para gestionar variables de entorno como tokens o identificadores de forma segura:

   ```bash
   npm install dotenv
   ```

4. **Nodemon:** Herramienta de desarrollo que supervisa cambios en el código y reinicia automáticamente el servidor sin interrupciones manuales. Instálala como dependencia de desarrollo:

   ```bash
   npm install nodemon --save-dev
   ```

### ¿Cómo organizar el editor de código?

Abre el editor en la carpeta med-pet con el siguiente comando (si utilizas Visual Studio Code):

```bash
 code .
```

En Visual Studio Code:

- **Crear un archivo .gitignore:** Añade node_modules para excluir esta carpeta del control de versiones, evitando subir dependencias innecesarias a Git.
- **Extensiones recomendadas:** Instala extensiones para facilitar la edición de código JavaScript y, si es posible, considera usar herramientas como GitHub Copilot para autocompletar y sugerencias de código.

[🡡 volver al inicio](#tabla-de-contenido)

## Configuración de Webhook para API de WhatsApp con Node.js

Para implementar una integración básica entre WhatsApp API y una aplicación de Node.js, sigue una serie de pasos que van desde configurar el servidor hasta establecer una conexión con la API de Meta para WhatsApp y realizar pruebas locales y públicas. Este proceso permite realizar un eco de los mensajes recibidos y replicarlos en el chat de WhatsApp, utilizando herramientas como Axios, Express y variables de entorno.

### ¿Cómo configurar el servidor de Node.js para WhatsApp API?

1. Preparar el entorno del servidor:

   - Dirígete a la documentación de WhatsApp API de Meta para consultar el código de ejemplo que puedes usar como base.
   - Usa Express para construir el servidor y Axios para interactuar con la API de WhatsApp.
   - Configura el archivo server.js y asegúrate de tener dotenv para manejar las variables de entorno necesarias.

2. Establecer las variables de entorno:

   - Crea un archivo .env que incluya:

     - WEBHOOK_VERIFY_TOKEN: un token secreto compartido con Meta para validar el webhook.
     - API_TOKEN: el token de acceso a la API.
     - PORT: el puerto en el cual se ejecutará el servidor.
     - BUSINESS_PHONE: el ID del teléfono de negocios registrado en Meta.
     - API_VERSION: la versión de la API en uso.

   - Excluye el archivo .env del control de versiones con .gitignore y proporciona un .env-example con las claves esperadas para futuros desarrolladores.

### ¿Cómo implementar el código de conexión y manejo de solicitudes?

1. Configurar el webhook:

   - Usa el webhook proporcionado por Meta para recibir y validar los mensajes entrantes.
   - Define la lógica para replicar los mensajes recibidos: cuando el bot reciba un mensaje, este debe responder con el mismo texto, emulando un “eco”.

2. Realizar cambios en las peticiones de Axios:

   - Personaliza el código de ejemplo para que la versión de la API y el ID de teléfono provengan de las variables de entorno, facilitando el mantenimiento.
   - Ajusta la autenticación de Axios para que utilice API_TOKEN.

3. Configurar NodeMon para un desarrollo continuo:

   - Crea un archivo nodemon.json para monitorear los cambios en el código en las carpetas y extensiones clave del proyecto.
   - Especifica los directorios y archivos que no deben observarse, como node_modules.

### ¿Cómo realizar pruebas locales y públicas?

1. Prueba local en Visual Studio Code:

   - Corre el servidor en el puerto 3000 y verifica la respuesta en localhost:3000.
   - Para probar la conexión con Meta, expón el puerto de desarrollo con el Port Forwarding de Visual Studio Code, lo cual crea una URL pública accesible temporalmente.

2. Configurar el webhook en Meta:

   - En el panel de desarrolladores de Meta, usa la URL pública y agrega WEBHOOK_VERIFY_TOKEN para validar la conexión.
   - Activa los permisos de “mensajes”, “templates” y “templates de quality update” para que el bot pueda enviar y recibir mensajes.

### ¿Cómo probar y depurar la integración?

1. Envía un mensaje de prueba:

   - Envía un mensaje al bot en WhatsApp. Si todo está configurado correctamente, el bot debe replicar el mensaje.
   - Si ocurre un error, verifica la consola de Node.js; errores comunes incluyen un 401 Unauthorized cuando el API_TOKEN expira.

2. Actualizar tokens:

   - Dado que los tokens tienen una caducidad, genera uno nuevo desde el panel de Meta, actualiza la variable API_TOKEN en .env y reinicia el servidor.

3. Optimizar para producción:

   - Aunque el Port Forwarding permite exponer el servidor para pruebas, evita usar esta configuración en producción.
   - Considera implementar una solución de hosting adecuada para el despliegue en producción con tokens de larga duración.

[🡡 volver al inicio](#tabla-de-contenido)

## Arquitectura MVC para Escalabilidad en Bots de Mensajería

Implementar un bot escalable usando una arquitectura organizada es esencial para gestionar su crecimiento y adaptabilidad a nuevos servicios. En este enfoque, se aplica la arquitectura Modelo-Vista-Controlador (MVC), dividiendo el proyecto en componentes específicos para garantizar claridad y facilitar futuras mejoras sin complicaciones.

### ¿Por qué es importante dividir el código en módulos?

Mantener toda la lógica en un solo archivo podría funcionar para proyectos pequeños, pero a medida que una aplicación crece, resulta insostenible. Dividir el código permite:

- **Escalabilidad:** Facilita agregar funciones sin afectar la estabilidad del sistema.
- **Mantenimiento:** Aislar cada función permite identificar y corregir errores más rápido.
- **Colaboración:** Permite que múltiples desarrolladores trabajen en diferentes áreas sin interferir entre sí.

### ¿Cómo se organiza la estructura del bot?

La estructura del proyecto se divide en carpetas específicas, ubicadas en una carpeta principal llamada src, cada una cumpliendo una función particular:

- **config:** Centraliza la configuración de variables de entorno para que puedan ser reutilizadas en toda la aplicación sin duplicación.
- **controllers:** Encargado de recibir y manejar solicitudes entrantes y salientes. Aquí se ubica el webhook controller, responsable de gestionar los mensajes de Meta y las rutas de Webhub.
- **routes:** Define las rutas específicas que la aplicación servirá usando Express.
- **services:** Contiene servicios esenciales, como Message Handle y WhatsApp Service, los cuales gestionan y envían mensajes a la API de WhatsApp.

### ¿Qué papel juegan los webhooks en esta configuración?

Los webhooks, configurados en el archivo webhub controller, manejan las solicitudes POST y GET en las rutas especificadas (/webhub). Este controlador permite:

- Validar que el servidor esté correctamente conectado con Meta.
- Filtrar mensajes entrantes según su tipo y decidir las acciones correspondientes (e.g., replicar o marcar como leído).

### ¿Qué aporta la clase WhatsApp Service?

La clase WhatsApp Service administra el envío de mensajes y la interacción directa con la API de WhatsApp, lo que permite:

- Enviar respuestas automáticas en función del tipo de mensaje recibido.
- Marcar mensajes como leídos tras la respuesta, mejorando la experiencia del usuario.

### ¿Cómo contribuye esta arquitectura al trabajo en equipo?

La modularización permite que los desarrolladores trabajen en componentes específicos sin interferir con otros. Esta estructura optimiza el rendimiento, evita errores por cambios simultáneos en el código y asegura que los desarrollos futuros sean implementados eficientemente.

### ¿Cómo se gestiona la inicialización de la aplicación?

El archivo App.js centraliza la configuración general de la aplicación, incluyendo:

- Configuración de variables de entorno y rutas de Webhub.
- Inicialización del servidor, dejando la lógica de manejo de solicitudes a los controladores y servicios.

[🡡 volver al inicio](#tabla-de-contenido)

## Conceptos básicos de validación de mensajes en programación

### ¿Cómo personalizar la respuesta de un bot para identificar al usuario?

El diseño de las respuestas de un bot es clave para lograr una interacción auténtica y personalizada con los usuarios. Para que el bot pueda identificar a cada usuario, necesitamos trabajar con ciertos elementos esenciales. En este caso, se utilizan dos: el ID del usuario compuesto por la lada del país y el número de WhatsApp, así como el nombre registrado. Al personalizar el saludo, el bot retorna un mensaje sensible que hace sentir al usuario valorado desde el primer contacto. Sin embargo, hay factores que debemos tener en cuenta:

- Los nombres de los usuarios pueden contener caracteres especiales o emojis que no siempre cumplen con reglas estándar.
- Aunque podemos usar expresiones regulares (regex) para extraer solo el primer nombre, esta no siempre es una solución universal.

El objetivo es establecer un mensaje de bienvenida cálido y desencadenar el flujo necesario.

### ¿Cómo configurar la lógica de identificación en el controller?

Para poder obtener la información del remitente, es esencial analizar la estructura del objeto de respuesta que nos ofrece la API que estamos utilizando. Necesitamos crear una constante llamada senderInfo, que nos ayude a acceder a los datos del contacto desde el primer índice del array de contactos. Este paso puede representarse con un código como el siguiente:

```javascript
const senderInfo = response.contacts[0];
```

Es recomendable familiarizarse con esta estructura de datos, utilizando herramientas como Postman para observar la información detallada que se puede obtener y, en consecuencia, identificar los elementos que serán útiles en futuras implementaciones.

### ¿Cómo realizar un reconocimiento de saludos?

Para mejorar la interacción inicial del bot, se implementa una función que reconoce si un mensaje recibido es un saludo. Esto se puede lograr definiendo una función llamada isGreeting que devuelva un booleano.

```javascript
function isGreeting(message) {
  const greetings = ["hello", "hi", "hola", "buenas tardes"];
  return greetings.includes(message.toLowerCase().trim());
}
```

Con esta función, el bot puede distinguir entre mensajes de saludo y otros tipos de interacciones, permitiéndole responder adecuadamente.

### ¿Cómo enviar un mensaje de bienvenida personalizado?

Una vez identificado el saludo, es hora de enviar un mensaje de bienvenida personalizado. Para ello, se define una función asincrónica sendWelcomeMessage que conforma el saludo tomando en cuenta especificidades como el nombre del servicio ofrecido.

```javascript
async function sendWelcomeMessage(user, messageId) {
  const welcomeMessage = `Hola, bienvenido a nuestro servicio de veterinaria online. ¿En qué puedo ayudarte hoy?`;
  await WhatsAppService.sendMessage(user, welcomeMessage, messageId);
}
```

Esta función se asegura de crear un sentimiento de acogida desde el primer contacto.

### ¿Cómo configurar la arquitectura y probar la lógica del bot?

Es crucial ajustar ciertos parámetros del entorno para que el bot funcione sin interrupciones:

- Dentro de package.json, podemos agregar un script para facilitar el inicio del servidor:

  ```javascript
  "scripts": {
    "start": "nodemon src/app.js"
  }
  ```

- Verificar que el servidor está corriendo correctamente accediendo a la terminal y validando los últimos cambios con NodeMon.

Realizar pruebas es fundamental. Envía "hola", "hi" o cualquier otro saludo predefinido y verifica que el mensaje correcto regrese. Notarás que los mensajes no reconocidos como saludos seguirán usando la lógica previa, consistente en replicar el mensaje original.

Explora y comenta qué tipo de saludo te parecería más efectivo para este contexto.

[🡡 volver al inicio](#tabla-de-contenido)

## Saludo Personalizado con Nombre desde WhatsApp

### ¿Cómo personalizar el saludo de bienvenida de un bot?

Un saludo personalizado puede hacer que la interacción con un bot sea mucho más cálida y amigable. Implementar esta función en tu chatbot no solo mejora la experiencia del usuario, sino que también da un toque personal a cada mensaje. A continuación te explicamos cómo lo hemos logrado usando el senderInfo para obtener y usar el nombre del usuario.

### ¿Cómo obtener el nombre del usuario?

Para personalizar el saludo, primero necesitas obtener el nombre del usuario que interactúa con el bot. Esto se hace a través de una variable llamada senderInfo, que contiene información del remitente. Sigue estos pasos:

1. En el controller de tu aplicación, asegúrate de mandar el senderInfo al manejar los mensajes.
2. Usa una función para extraer el nombre del usuario del senderInfo. Esta función la llamaremos getSenderName.
3. Si el nombre no está disponible, utiliza el número identificador de WhatsApp o deja un mensaje genérico, como "Hola estudiante".

Aquí hay un ejemplo de cómo puedes obtener el nombre:

```javascript
function getSenderName(senderInfo) {
  return senderInfo.profile.name || senderInfo["wa-id"] || "";
}
```

### ¿Cómo implementar un mensaje de saludo personalizado?

Una vez que tienes el nombre del usuario, el siguiente paso es integrar este nombre en un mensaje de bienvenida utilizando plantillas de literales (template literals en JavaScript):

```javascript
const name = getSenderName(senderInfo);
const welcomeMessage = `Hola, ${name}, bienvenido a MedPet. ¿En qué puedo ayudarte hoy?`;
```

Al utilizar plantillas de literales, puedes manipular el mensaje fácilmente y lograr que el texto se vea más natural y acogedor.

### ¿Qué hacer cuando el nombre es un nombre completo?

Uno de los desafíos es que, a menudo, los usuarios configuran su nombre completo en su perfil de WhatsApp. A veces, incluir los apellidos no es necesario para un saludo cálido tipo "Hola, [nombre]". Para solucionar esto, puedes usar expresiones regulares (regex) que extraigan solo el primer nombre.

Por ejemplo, podrías implementar algo así:

```javascript
function getFirstName(name) {
  const firstName = name.split(" ")[0]; // Divide el nombre completo y toma la primera porción
  return firstName;
}
```

### Desafíos y recomendaciones

- **Evaluar la diversidad de los nombres:** Considera que algunos usuarios podrían tener caracteres especiales o emojis en sus nombres. Asegúrate de que tu lógica los maneje adecuadamente.
- **Mejora constante:** Prueba tu bot con diferentes usuarios y casos para afinar su funcionalidad.
- **Comunicación y personalización:** Ofrecer saludos personalizados ayuda a construir una relación más cercana con los usuarios, incrementando el engagement y mejorando su experiencia.

[🡡 volver al inicio](#tabla-de-contenido)

## Menús interactivos en WhatsApp: guía para bots con Postman y API

Crear un flujo de interacción con usuarios en WhatsApp puede ser determinante para optimizar la experiencia y direccionar sus consultas. Utilizando la API de WhatsApp y Postman, es posible construir un bot interactivo que, mediante botones personalizados, guía al usuario paso a paso. Esta interacción evita que el usuario se sienta perdido y garantiza respuestas rápidas y precisas.

### ¿Cómo configurar el flujo de mensajes para iniciar la conversación?

El flujo se inicia compartiendo una URL en redes sociales o integrando un enlace en publicaciones que invite a iniciar una conversación en WhatsApp. Esto desencadena el mensaje de bienvenida, que introduce al usuario en la estructura de opciones predefinidas.

**Mensaje de Bienvenida:** Este primer mensaje es la base de la interacción.
**Guía de opciones:** Al ofrecer opciones concretas, se facilita al usuario elegir la acción deseada y previene errores en el flujo de la conversación.

### ¿Cómo crear un menú de opciones en WhatsApp?

WhatsApp permite el uso de botones mediante su API, que se pueden personalizar con Postman. Los botones reducen las probabilidades de error al permitir solo tres opciones visibles, diseñadas para que el usuario responda sin necesidad de escribir texto.

### Pasos básicos en Postman

1. **Configura el cuerpo del mensaje:** La estructura debe contener un type de interactive, especificando que se trata de botones.
2. **Define el cuerpo y las acciones:** Cada botón tendrá un texto y una acción específica que desencadenará la siguiente interacción.
3. **Envía el mensaje:** Con esta estructura, se prueba la funcionalidad desde Postman para ver la respuesta en WhatsApp.

### ¿Cómo implementar la lógica en el código del bot?

Es necesario crear una función en el servicio de WhatsApp que maneje estos botones interactivos y permita responder según las opciones elegidas.

- **Función sendInteractiveBottoms:** Define el cuerpo del mensaje, las acciones y el tipo de botón.
- **Try-Catch para solicitudes HTTP:** Permite gestionar errores en tiempo real y asegura que el mensaje se envíe correctamente.

Dentro del controlador de mensajes (Message Handle), se define otra función, sendWelcomeMenu, que recibe el destinatario y presenta el menú de opciones.

Ejemplo de opciones configurables:

- Agendar una cita
- Realizar una consulta
- Consultar la ubicación de la veterinaria

Cada opción lleva un ID único y un título visible, limitando el menú a tres elementos. Este flujo es similar al de un conmutador telefónico, en el que cada selección lleva al usuario a un submenú específico.

### ¿Cómo personalizar y extender el flujo de interacción?

Si bien solo se permiten tres botones, es posible estructurar múltiples submenús para facilitar otras opciones. Esto implica pensar en los flujos de cada sección (como agendar una cita) y decidir si el usuario seguirá usando botones o si se guiará mediante mensajes de texto.

### Consideraciones para un flujo optimizado

- Limitar el menú principal a las tres opciones más solicitadas.
- Configurar submenús dentro de cada opción si el flujo lo permite.
- Probar la estructura en WhatsApp y asegurar que la respuesta sea rápida y efectiva.

[🡡 volver al inicio](#tabla-de-contenido)

## Manejo de Interacciones en Bot de WhatsApp con JavaScript

### ¿Cómo capturar la interacción del usuario con botones?

¡Vamos a mejorar la experiencia del usuario! Cuando un usuario selecciona opciones como "Agendar", "Consultar" o "Ubicación", necesitamos capturar esas interacciones y responder de manera adecuada. Para lograrlo, debemos modificar nuestro código y asegurarnos de manejar estos eventos correctamente.

```javascript
else if (message?.type === 'interactive') {
    const opcionEligida = message?.interactive?.button_reply?.title.toLowerCase();
    handleMenuOption(mesasFrom, opcionEligida);
    WhatsAppService.marcadoLeido(mesasID);
}
```

### ¿Cómo procesar la opción seleccionada?

Una vez capturada la interacción, crearemos una función llamada handleMenuOption para manejar las acciones basadas en la opción del usuario. Esta función permitirá construir el flujo de respuestas esperado.

```javascript
async function handleMenuOption(quien, opcion) {
  let response;

  switch (opcion) {
    case "agendar":
      response = "Vamos a agendar una cita. Aquí está el flujo...";
      break;

    case "consultar":
      response = "Realiza tu consulta ahora.";
      break;

    case "ubicacion":
      response = "Esta es nuestra ubicación.";
      break;

    default:
      response =
        "Lo siento, no entendí tu selección. Por favor, elige una de las opciones del menú.";
      break;
  }

  await WhatsAppService.sendMessage(quien, response);
}
```

### ¿Cómo enviar respuestas según la lógica definida?

Después de determinar la opción que el usuario eligió, enviaremos una respuesta. Para mantener una buena comunicación, es importante reutilizar el servicio de mensajes de WhatsApp en modo texto, evitando crear múltiples lógicas para manejar diferentes tipos de mensajes.

### Manejo de errores: ¿qué hacer si algo falla?

Los errores son nuestros aliados cuando se trata de depuración. En este caso, si encontramos un error durante la ejecución, es crucial revisar los 'logs' que invitan con información detallada sobre la falla, como un parámetro ausente o un invalid request.

```javascript
WhatsAppService.sendMessage(quien, response).catch((error) => {
  console.error("Error al enviar el mensaje:", error);
});
```

### ¿Cómo mejorar la funcionalidad del bot?

¡Es solo el comienzo! Al lograr que el bot reconozca y maneje interacciones básicas, podemos empezar a incluir contenido multimedia y otros recursos, como imágenes o audios, que enriquecerán los flujos de interacción y ofrecerán una experiencia más dinámica.

Continúa explorando y construyendo funciones adicionales para agendar citas, enviar ubicaciones precisas y guardar información proporcionada por el usuario. Con cada paso, el bot se convertirá en una poderosa herramienta de soporte y automatización, ¡así que sigue aprendiendo y experimentando!

[🡡 volver al inicio](#tabla-de-contenido)

## Envío de Archivos Multimedia con API de WhatsApp

### ¿Cómo enviar archivos multimedia en WhatsApp?

La capacidad de enviar archivos multimedia a través de WhatsApp ofrece una mayor diversidad en la comunicación. Utilizando la API de WhatsApp, es posible enviar diversos formatos de archivos multimedia, como audios, videos, imágenes y documentos. Esta funcionalidad es esencial para integrar diferentes tipos de contenido en bots, haciéndolos más interactivos y atractivos. Cada formato tiene sus particularidades y se requiere de una estructura específica para enviar estos archivos correctamente.

### ¿Cuáles formatos de archivos se pueden enviar?

Con la API de WhatsApp, es posible enviar varios tipos de archivos multimedia. Estos incluyen:

- **Imágenes:** Pueden enviarse usando URLs o IDs y pueden ir acompañadas de un Caption, un mensaje que acompaña la imagen.
- **Audios:** Se deben almacenar en la nube y enviar a través de un enlace.
- **Videos:** Su estructura es similar a las imágenes, incluyendo un link y un Caption opcional.
- **Documentos:** Al igual que los videos e imágenes, su estructura puede incluir un link y un Filename para definir el nombre del documento.

Explorar la API Reference y entender estas especificaciones es crucial para seleccionar el formato y tamaño adecuado al enviar archivos.

### ¿Cómo programar la lógica para enviar estos archivos?

Crear la lógica para enviar archivos multimedia implica desarrollar un servicio que reconozca el tipo de archivo y configure la estructura adecuada para la API. A continuación, se detalla cómo podría hacerse esto en código:

```javascript
async function SendMediaMessage(to, type, mediaURL, caption) {
  let mediaObject = {};

  switch (type) {
    case "image":
      mediaObject = {
        image: {
          link: mediaURL,
          caption,
        },
      };
      break;
    case "audio":
      mediaObject = {
        audio: {
          link: mediaURL,
        },
      };
      break;
    case "video":
      mediaObject = {
        video: {
          link: mediaURL,
          caption,
        },
      };
      break;
    case "document":
      mediaObject = {
        document: {
          link: mediaURL,
          caption,
          filename: "medpet.pdf",
        },
      };
      break;
    default:
      throw new Error("No es soportado. Media type");
  }

  try {
    await axios.post("API_URL", {
      to,
      type,
      ...mediaObject,
    });
  } catch (error) {
    console.error("Error al enviar el archivo multimedia:", error);
  }
}
```

### ¿Cómo manejar errores en el envío de archivos?

Es fundamental tener un manejo de errores adecuado al enviar archivos multimedia, ya que puede haber fallos durante el proceso de conexión con la API. Utilizando un bloque try-catch, podemos capturar y manejar estos errores, registrando qué tipo de error ocurrió para facilitar su solución:

```javascript
try {
  // Lógica para enviar el mensaje
} catch (error) {
  console.error("Error sending media:", error);
}
```

### ¿Qué importancia tiene el flujo de envío en una aplicación?

La correcta ejecución y manejo del flujo de envío en una aplicación es crucial. Debemos desencadenar el envío de archivos multimedia desde un flujo de programación controlado, evitando errores que puedan ocurrir debido a la interacción directa del usuario. Esto significa que el envío de multimedia debería programarse para responder a eventos específicos en la aplicación, asegurando que solo se transfieran tipos de archivos soportados.

Al continuar el proceso de aprendizaje e implementación de estas prácticas, se potencia la capacidad de desarrollar aplicaciones más integradas e interactivas. Cada detalle y ajuste realizado en el código contribuyen a un funcionamiento más robusto y amigable.

[🡡 volver al inicio](#tabla-de-contenido)

## Uso de WhatsApp para Envío de Mensajes Multimedia

### ¿Cómo integrar el envío de mensajes multimedia en una aplicación?

En el desarrollo de aplicaciones de mensajería, integrar la capacidad de enviar mensajes multimedia puede enriquecer enormemente la experiencia del usuario. En este contenido, exploraremos cómo implementar esta función de manera eficiente, desde la inicialización hasta la ejecución, y descubriremos maneras interesantes de utilizar estos envíos gracias al machine learning o la inteligencia artificial.

### ¿Cómo configurar el flujo para enviar medios?

Para integrar y estructurar el envío de medios, comenzamos con la inicialización del recurso en nuestro código. Utilizamos Async para llamar a la función SendMedia y pasamos la información necesaria, construyendo la lógica que permitirá el envío de datos multimedia.

- Elementos necesarios:

  - **media URL:** La dirección del archivo multimedia.
  - **caption:** Mensaje acompañante, útil para audios o videos.
  - **type:** Tipo de archivo (audio, video, imagen, o documento).

Implementamos la función whatsappservice.sendmediamessage para definir:

- Destinatario del mensaje.
- Formato del archivo.
- URL del medio.
- Texto opcional del caption.

### ¿Cómo se estructura el código para diferentes tipos de medios?

El código está organizado para enviar tipos específicos de medios (audio, video, imagen, documento) según la interacción del usuario. Por ejemplo, se muestra un flujo de código para enviar un audio:

```javascript
if (incomingMessage === "media") {
  await this.sendMedia({
    messageFrom,
    type: "audio",
    mediaURL: "your-audio-url",
    caption: "Bienvenida",
  });
}
```

### ¿Cuáles son las prácticas recomendadas para el manejo de archivos multimedia?

Al manipular y almacenar archivos multimedia, sigue estas recomendaciones para un flujo eficiente:

- **Sube tus archivos a un manejador de contenido:** Utiliza plataformas como Amazon S3 para asegurar URLs estables y seguras.
- **Valida tipos y formatos:** Asegúrate de que los tipos de archivo cumplen con los requerimientos del servicio de mensajería.
- **Centraliza recursos multimedia:** Guarda infografías o documentos en colecciones para su fácil acceso y envío.

### ¿Cómo hacer los envíos más dinámicos?

Tenemos la posibilidad de hacer que los envíos respondan a comandos más específicos, enriqueciendo el uso:

1. **Diferenciar por tipo de medio:** Define palabras clave específicas para enviar distintos tipos de archivos.
2. **Automatización contextual:** Combina la lógica de comandos específicos con inteligencia artificial para ofrecer mensajes personalizados según el contexto o necesidad del usuario.

### ¿Qué desafíos se presentan en la implementación?

Algunos de los desafíos incluyen:

- **Fuentes de error invisibles:** El envío falla sin notificación de errores visibles; se debe revisar con minuciosidad la compatibilidad del documento.
- **Flexibilidad en flujos conversacionales:** Implementar una estructura clara que soporte diferentes flujos dentro de una conversación sin complicaciones.
- **Interacción adaptativa:** La lógica para el envío debe evolucionar según los patrones de uso y feedback de usuarios.

### ¿Qué mejoras sugieres para el flujo de trabajo?

Para maximizar la eficiencia del flujo de trabajo integrado:

- **Adopta frameworks de prueba:** Evalúa continuamente la funcionalidad con pruebas automatizadas.
- **Fomenta el feedback del usuario:** Recopila y analiza el feedback para adaptar las funcionalidades.
- **Explora nuevas tecnologías:** Implementa herramientas de AI para crear experiencias personalizadas e intuitivas.

### Conclusión

Implementar envíos multimedia añade significativamente valor a las aplicaciones de mensajería. Con buenas prácticas de desarrollo y un enfoque hacia la automatización, puedes crear una experiencia más rica y útil para tu usuario final.

[🡡 volver al inicio](#tabla-de-contenido)

## Flujo Completo para Agendar Citas en un Bot de Mensajería

### ¿Cómo crear un flujo de agenda de citas en un bot?

La creación de un flujo de agenda de citas en un bot puede ser una tarea compleja, pero siguiendo una serie de pasos lógicos y bien estructurados, podemos facilitar este proceso. En este ejercicio, vamos a programar un flujo que solicite información al usuario, como el nombre de la mascota, tipo de mascota y la razón de la consulta, y la almacene para confirmar la cita. El flujo se controlará a través de un constructor en la clase MessageHandler. A continuación, detallaremos los pasos clave para lograrlo.

### ¿Qué es un constructor y para qué se utiliza en este flujo?

El constructor es una función que inicializa los objetos creados a partir de una clase. En este caso, inicializamos un estado que contendrá los pasos del flujo de agendar la cita, permitiéndonos mantener el control en cada etapa del proceso.

Este constructor, dentro de la clase MessageHandler, manejará el estado de la reserva. Asignamos un objeto vacío a this.appointmentState, que se llenará conforme el flujo avance por medio de preguntas al usuario:

```javascript
constructor() {
  this.appointmentState = {};
}
```

### ¿Cómo manejamos el estado del flujo con un switch?

Utilizamos una estructura de control switch para manejar cada paso del flujo. Según el estado actual (state.step), ejecutamos un caso específico que realiza acciones como preguntar o almacenar datos.

1. Solicitar el nombre de la mascota:

   ```javascript
   case 'name':
     state.name = message;
     state.step = 'petName';
     response = 'Gracias, ¿cuál es el nombre de tu mascota?';
     break;
   ```

2. Pedir el tipo de mascota:

   ```javascript
   case 'petName':
     state.petName = message;
     state.step = 'petType';
     response = '¿Qué tipo de mascota es? (ej. perro, gato, etc.)';
     break;
   ```

3. Motivo de la consulta:

   ```javascript
   case 'petType':
     state.petType = message;
     state.step = 'reason';
     response = '¿Cuál es el motivo de la consulta?';
     break;
   ```

4. Confirmación de la cita:

   ```javascript
   case 'reason':
     state.reason = message;
     response = 'Gracias por agendar tu cita.';
     // Opcional: lógica para guardar la cita en el sistema
     break;
   ```

### ¿Cómo inicializar el flujo y enviar mensajes?

Tras definir el flujo con el switch, necesitamos inicializarlo adecuadamente cuando el usuario selecciona la opción correspondiente en el menú de acciones del bot. Esto se hace dentro del método handleMenuOptions.

- Inicializar el estado:

  ```javascript
  this.appointmentState[user] = { step: "name" };
  ```

- Enviar el mensaje inicial:

  ```javascript
  await sendMessage(user, "Por favor, ingresa tu nombre.");
  ```

### ¿Qué errores comunes podemos encontrar y cómo solucionarlos?

A menudo, durante el desarrollo, encontramos errores que pueden detener el flujo del programa. Por ejemplo:

- **Errores de referencia:** Un error común es intentar usar una variable no definida como step en lugar de state.step. Verificar correctamente las asignaciones dentro de los casos del switch puede resolver el problema.
- **Validación y pruebas:** Probar continuamente cada cambio asegura que el flujo funcione correctamente y ayuda a identificar errores incipientes. Por ejemplo, verificar que después de cada caso, el flujo avance correctamente al siguiente paso.

### ¿Cómo probar el flujo completo?

Para asegurarse de que todo funciona adecuadamente, iniciaremos el bot y simularemos el proceso de agendar una cita desde el principio:

1. Iniciar el bot y decir "Hola" para recibir el menú de bienvenida.
2. Seleccionar la opción de agendar cita.
3. Responder progresivamente a cada pregunta con datos ficticios como "Oscar" para el dueño y "Mickey" para el nombre de la mascota.
4. Comprobar que el flujo avanza correctamente y que las respuestas se recogen y procesan como esperamos.

Este proceso iterativo de codificar, probar y corregir nos ayuda a asegurar un funcionamiento fluido del bot.

Aprender a manejar estados y flujos te permitirá desarrollar sistemas más complejos y eficientes en el futuro.

[🡡 volver al inicio](#tabla-de-contenido)

## Manejo de Citas para Mascotas: Registro y Confirmación

### ¿Cómo se puede gestionar un flujo de citas médicas para mascotas en una aplicación?

Hoy exploraremos cómo gestionar eficazmente las citas de mascotas en una aplicación, asegurando que todos los detalles importantes se preserven para futuros usos. La idea central es implementar una lógica que garantice el almacenamiento seguro y la presentación adecuada de la información de las citas, mejorando la experiencia tanto del usuario como del administrador de la aplicación.

### ¿Cuál es la lógica que sustenta un flujo de citas?

Iniciaremos el proceso al crear una función que se encargue de manejar el cierre de una cita y la captura de los datos proporcionados por el usuario. Un flujo bien diseñado debe tener en cuenta cómo el usuario interactúa con la aplicación, y en este caso, garantizar que toda la información relevante se capture y se gestione adecuadamente.

1. **Creación de Complete Appointment:**

   - Este segmento se asegura de que los detalles del usuario y de la cita se capturen para su posterior gestión.
   - Utilizamos console.log para mostrar los datos que el usuario ha introducido, permitiendo una revisión básica.

2. **Eliminar datos temporales:**

   - Para optimizar el uso de la memoria, eliminamos los datos temporales una vez guardada la información necesaria.

3. **Manejo de la información almacenada:**

   - Es fundamental crear constantes tanto para las citas como para los datos de usuario, garantizando que la información esté bien estructurada.

### ¿Cómo se construye un mensaje de confirmación robusto?

La confirmación es esencial para que el usuario esté tranquilo al saber que su cita se gestionó apropiadamente. Aquí, el uso de los template literals de JavaScript resulta altamente beneficioso para formatear mensajes personalizados y detallados.

```javascript
const TheAppointment = {
  name: "Oscar",
  petName: "Mickey",
  petType: "gato",
  reason: "Consulta general",
};

return `Gracias por agendar tu cita.
Resumen de tu cita:
Nombre: ${TheAppointment.name}
Nombre de la mascota: ${TheAppointment.petName}
Tipo de mascota: ${TheAppointment.petType}
Motivo: ${TheAppointment.reason}
Nos pondremos en contacto contigo pronto para confirmar la fecha y hora de tu cita.`;
```

### ¿Cómo se implementa y valida este flujo?

Para integrar el flujo en la aplicación de manera efectiva, es vital que todos los elementos involucrados trabajen sincronizadamente. Aquí algunos pasos recomendados:

1. **Integración en el flujo:**

   - Asegúrate de que la función CompleteAppointment se ejecute adecuadamente, actuando sobre las entradas del usuario.

2. **Validación del sistema:**

   - Comprueba que el servidor esté operativo y que las interacciones del bot se realicen sin inconvenientes.

3. **Prueba con datos reales:**

   - Interactúa con la aplicación simulando escenarios reales donde el usuario nombre a su mascota y defina el tipo y motivo de la cita.

### ¿Dónde podríamos almacenar esta información?

Para poder almacenar y acceder a esta información a largo plazo, considerar opciones como bases de datos o servicios cloud puede ser una excelente idea. Algunos servicios recomendados incluyen:

- **Bases de Datos Relacionales:** MySQL, PostgreSQL.
- **Servicios en la nube:** Firebase, AWS DynamoDB.

Es importante elegir una opción que se adapte bien a las necesidades de la aplicación y que garantice escalabilidad y seguridad.

[🡡 volver al inicio](#tabla-de-contenido)

## Integración de Google Sheets API para Guardar Datos del Bot

### ¿Cómo integrar nuestro bot con Google Sheets?

¡Gracias por llegar hasta aquí y acompañarnos en este fascinante viaje de construir un chatbot funcional y efectivo! Imagina que has logrado crear un bot que interactúa de manera eficiente, personalizado y con un menú de opciones, pero eso es solo el principio. Ahora, queremos que toda esa información generada en las conversaciones no solo viva en nuestro bot, sino que también pueda ser consultable externamente en un entorno accesible y manejable. Para esto, haremos uso de la poderosa herramienta que es Google Sheets al integrarla mediante su API.

### ¿Qué necesitamos para comenzar con la API de Google Sheets?

Para integrar Google Sheets, el primer paso es registrarse o iniciar sesión en Google Console. Ahí es donde se manejan todas las API disponibles en la nube de Google. Este entorno nos da acceso a múltiples recursos gratuitos que, aunque en algunos casos podrían tener costos asociados, podremos usar sin pagar en este ejemplo práctico.

Sigue estos pasos iniciales:

1. Crea un nuevo proyecto en Google Console, asignándole un nombre, por ejemplo, "MedPet".
2. Selecciona el proyecto creado y habilita la API de Google Sheets para que puedas interactuar con los documentos de manera programática.

### ¿Cómo obtener las credenciales necesarias?

Para interactuar con la API de Google Sheets, necesitamos conseguir un archivo de configuración y crear credenciales. Aquí te explicamos a detalle cómo hacerlo:

1. Crear credenciales:

   - Selecciona la API de Google Sheets y elige "Datos del usuario" como tipo de datos.
   - Crea una aplicación web nombrada "MedPet", donde también debes añadir tu correo electrónico asociado.

2. Crear credenciales de servicio:

   - La credencial será de tipo "Cuenta de servicio".
   - Asigna un nombre a la cuenta, por ejemplo, "medpet0".
   - Copia el correo asociado a esta cuenta, ya que se necesitará posteriormente.
   - Genera una clave en formato JSON y descárgala. Este archivo es crucial para conectar tu aplicación con Google Sheets.

3. Configurar credenciales en tu proyecto:

   - En Visual Studio Code, crea una nueva carpeta llamada "credenciales" y agrege el archivo JSON descargado anteriormente.
   - Esto completa la configuración básica para empezar a interactuar con Google Sheets desde tu proyecto.

### ¿Cómo configurar Google Sheets para recibir datos?

Una vez que tenemos nuestras credenciales listas, es momento de preparar el documento de Google Sheets que almacenará nuestros datos generados por el bot.

1. Crear un documento en Google Sheets:

   - Puedes crear un nuevo documento o usar un template disponible en la sección de recursos.
   - Es importante que esté ligado a tu cuenta de Google Cloud.

2. Dar permisos de edición a la cuenta de servicio:

   - Comparte el documento con la cuenta de correo electrónico de servicio creada anteriormente.
   - Asigna el rol de editor para poder insertar registros.

### Recomendaciones finales

A medida que avanzas en la integración y configuración, recuerda verificar que todos los campos en tu hoja de cálculo correspondan con los datos que tu bot recopila. Alinear estos elementos garantizará que los datos se inserten correctamente y se mantenga la integridad de la información.

[🡡 volver al inicio](#tabla-de-contenido)

## Integración de Google Sheets con Node.js para Reservas Automáticas

### ¿Cómo integrarse con la API de Google Sheets?

Integrarse con la API de Google Sheets puede abrir un mundo de posibilidades para automatizar y gestionar datos dinámicamente desde diferentes aplicaciones. En este artículo, exploramos cómo configurar esta integración en un entorno JavaScript para comunicar datos desde un bot de WhatsApp hacia una hoja de cálculo en Google Sheets. Este proceso no solo mejora la eficiencia en la gestión de datos, sino que también optimiza la interacción con los usuarios de forma automática. Profundicemos en los pasos para implementar esta integración.

### ¿Cómo se instala la dependencia Google APIs?

El primer paso para integrar nuestra aplicación con la API de Google Sheets es instalar la dependencia de Google APIs. Ejecutamos el siguiente comando en la terminal:

npm install googleapis

Este paquete nos permitirá trabajar fácilmente con las distintas APIs de Google. A continuación, crea un nuevo recurso dentro de la carpeta Services llamado GoogleSheetsService. Este archivo alojará la lógica para interactuar con las hojas de cálculo.

### ¿Cuál es la lógica básica de comunicación con la API?

La lógica para la comunicación con Google Sheets implica varios pasos importantes. Inicialmente, se importan recursos necesarios y se configura la autenticación con las credenciales apropiadas.

```javascript
import path from "path";
import { google } from "googleapis";

const Sheets = google.sheets("v4");

// Función para agregar fila a Google Sheet
async function addRowToSheet(auth, spreadsheetId, values) {
  const request = {
    spreadsheetId,
    range: "reservas",
    valueInputOption: "RAW",
    insertDataOption: "INSERT_ROWS",
    resource: { values },
    auth,
  };

  try {
    const response = await Sheets.spreadsheets.values.append(request);
    return response;
  } catch (error) {
    console.error(error);
  }
}
```

### ¿Cómo se realiza la autenticación y se utiliza el cliente autorizado?

La autenticación se establece utilizando un archivo de credenciales. Este archivo debe ubicarse de manera segura dentro de nuestro proyecto y su ruta debe definirse correctamente.

```javascript
const auth = new google.auth.GoogleAuth({
  keyFile: path.join(process.cwd(), "src", "credentials", "credentials.json"),
  scopes: ["https://www.googleapis.com/auth/spreadsheets"],
});

async function appendToSheet(data) {
  try {
    const authClient = await auth.getClient();
    const spreadsheetId = "tu_spreadsheet_id_aqui";
    await addRowToSheet(authClient, spreadsheetId, data);
    console.log("Datos correctamente agregados.");
  } catch (error) {
    console.error("Error al agregar los datos:", error);
  }
}
```

### ¿Cómo integrar la lógica en la aplicación principal?

Una vez que tenemos nuestra lógica de servicio, debemos integrar esta función dentro de la aplicación para que, cuando un usuario complete el flujo en el bot de WhatsApp, la información se envíe a Google Sheets.

```javascript
import { appendToSheet } from "./services/GoogleSheetsService";

// Dentro de la función que maneja mensajes
async function messageHandler(message) {
  // Código existente
  const data = [
    message.from,
    message.name,
    message.petName,
    message.petType,
    message.query,
  ];

  try {
    await appendToSheet(data);
    console.log("Información enviada al Google Sheets.");
  } catch (error) {
    console.error("Error al enviar los datos:", error);
  }
}
```

### ¿Cuáles son los errores comunes y sus soluciones?

Durante la implementación, es común enfrentarse a errores tipográficos o problemas de configuración. Estos pueden incluir errores de tipos de datos, errores de autenticación o rutas incorrectas. Una solución frecuente es revisar cuidadosamente el código en busca de inconsistencias y asegurarse de que las credenciales estén correctamente configuradas.

- Verifica la correcta configuración del archivo JSON de credenciales.
- Revisa los nombres de las variables para evitar errores tipográficos.
- Asegúrate de que el spreadsheetId sea correcto y válido.

Finalmente, el buen mantenimiento de un formato de código legible no solo facilita la detección de errores sino que también mejora la colaboración y la comprensión por parte de otros desarrolladores.

[🡡 volver al inicio](#tabla-de-contenido)

## Integración de ChatGPT en Bots Veterinarios con API de OpenAI

### ¿Cómo conectar un bot con Chat GPT utilizando la API de OpenAI?

La conexión de un bot con Chat GPT a través de su API es una de las funciones más esperadas por los desarrolladores. Imagina un asistente que pueda responder a inquietudes sobre el comportamiento de una mascota antes de visitar al veterinario. Este flujo permite tener un primer diagnóstico o consejo basado en inteligencia artificial. El proceso no requiere ser un experto en programación, pero sí contar con una cuenta de OpenAI y conocer algunos conceptos básicos de integración de API.

### ¿Qué se necesita antes de comenzar?

Primero, es esencial tener una cuenta en OpenAI. Allí podrás obtener un API key, necesario para realizar las solicitudes. También es crucial referirse a la documentación de OpenAI para entender todas las capacidades y configuraciones posibles.

- **Cuenta en OpenAI:** Crea una en el sitio web de OpenAI.
- **API key:** Generada en la consola de usuario de OpenAI.
- **Visual Studio Code** (o editor de código de tu preferencia): Para la implementación del código.
- **NPM:** Para instalar dependencias necesarias.

### ¿Cómo instalar la dependencia de OpenAI?

Para poder utilizar los servicios de OpenAI desde tu programa de forma fluida, se debe instalar su dependencia usando NPM.

```bash
npm install openai
```

Esta línea se añade desde la consola de tu editor de código, asegurando que se detenga el servicio antes de iniciar la instalación.

### ¿Cómo crear un archivo de servicio en Node.js?

Una vez instalada la dependencia, hay que establecer un nuevo archivo que contendrá la lógica de comunicación con la API.

```javascript
import openai from "openai";
import config from "./config.js";

const client = new openai({
  apiKey: config.CHAT_GPT_API_KEY,
});

const openAiService = async (message) => {
  try {
    const response = await client.chat.completitions.create({
      messages: [
        { role: "system", content: "Eres una veterinaria." },
        { role: "user", content: message },
      ],
      model: "gpt-4",
    });
    return response.choices[0].message.content;
  } catch (error) {
    console.error(error);
  }
};

export default openAiService;
```

### ¿Cómo manejar las variables de entorno?

Las variables de entorno son clave para la seguridad, ya que contienen información sensible como el API key. Asegúrate de que estén correctamente configuradas y no las subas a repositorios públicos. Usa archivos .env para gestionar estas variables y asegúrate de agregar un archivo example para guiar a otros posibles colaboradores.

Generación de un nuevo API key:

1. Accede a "User API Keys" en OpenAI.
2. Crea una nueva clave, asígale un nombre identificativo.
3. Copia la clave y guárdala en un lugar seguro, como un gestor de contraseñas.

### ¿Cómo se integra el servicio en el flujo del bot?

Con la lógica desarrollada y las claves en su lugar, el siguiente paso es integrar este servicio en la aplicación existente. Esto implica exportar la función openAiService y utilizarla en el punto del bot donde se desea proporcionar respuestas basadas en inteligencia artificial.

Recuerda personalizar el prompt según el contexto del bot para asegurar que las respuestas sean acordes a las expectativas de los usuarios.

[🡡 volver al inicio](#tabla-de-contenido)

## Integración de ChatGPT en Flujo de Mensajería con WhatsApp

### ¿Cómo integrar OpenAI Service con el flujo de un chatbot?

Integrar un servicio de inteligencia artificial como OpenAI en un chatbot puede ser un proceso desafiante pero gratificante. La posibilidad de mejorar la comunicación automatizada y ofrecer respuestas precisas da un valor añadido enorme a cualquier proyecto. Aquí te mostramos un proceso paso a paso para lograr esta integración usando Assistant State y OpenAI.

### ¿Cómo inicializar el estado del asistente?

Para comenzar, debes asegurarte de que el servicio OpenAI ya esté conectado y haya un prompt del sistema esperando un mensaje del usuario. La clave inicial es establecer el estado del asistente dentro del constructor de la lógica existente. Este estado, Assistant State, será crucial para saber cuándo pasar al flujo de preguntas y respuestas, permitiendo que la inteligencia artificial responda de manera adecuada.

```javascript
// Inicialización del estado del asistente
constructor() {
    this.assistantState = {};
}

// Definición del estado al recibir mensaje del usuario
else if (this.assistantState) {
    // Lógica de manejo de estado
}
```

### ¿Cómo detectar el estado del asistente?

El siguiente paso es modificar el manejo de los mensajes entrantes para que el sistema pueda detectar cuando el estado del asistente está presente. Esto permitirá desviarse al flujo adecuado de procesamiento, utilizando una serie de condicionales para manejar las diferentes lógicas.

```javascript
// Detectar el estado y redireccionar el flujo
else if (this.assistantState && messageFrom) {
    await this.handleAssistantFlow(messageFrom, incomingMessage);
}
```

### ¿Cómo manejar el flujo del asistente?

Para manejar el flujo del asistente, es necesario implementar la lógica que interactúe con el servicio de OpenAI. Esto involucra crear una función llamada handleAssistantFlow y manejar el estado de interacción con el usuario.

```javascript
// Implementación del flujo del asistente
async handleAssistantFlow(user, message) {
    const state = this.assistantState[user.id];
    let response;

    if (state.step === 'question') {
        response = await openAIService.message(user.message);
    }

    // Enviando respuesta al usuario
    await whatsappService.sendMessage(user, response);

    // Lógica para botones de interacción
    const menuMessage = "¿La respuesta fue de ayuda?";
    const buttons = [
        { type: 'reply', reply: { id: 'option1', title: 'Sí, gracias.' } },
        { type: 'reply', reply: { id: 'option2', title: 'Hacer otra pregunta' } },
        { type: 'reply', reply: { id: 'option3', title: 'Emergencia' } }
    ];
    await whatsappService.sendInteraction(user, menuMessage, buttons);
}
```

### ¿Cómo enviar interacciones basadas en botones?

Una característica poderosa es enviar interacciones que no solo se limitan a texto, sino también incluyen opciones de botón. Esta funcionalidad no solo mejora la experiencia del usuario, sino que también permite respuestas rápidas a situaciones de emergencia o seguimiento de preguntas.

```javascript
// Ejemplo de estructura de botones
const menuMessage = "¿La respuesta fue de ayuda?";
const buttons = [
  { type: "reply", reply: { id: "option1", title: "Sí, gracias." } },
  { type: "reply", reply: { id: "option2", title: "Hacer otra pregunta" } },
  { type: "reply", reply: { id: "option3", title: "Emergencia" } },
];

// Envío del menú de botones
await whatsappService.sendInteraction(user, menuMessage, buttons);
```

### ¿Cómo probar y ajustar el flujo?

Una vez que toda la lógica esté en su lugar, es importante validar y probar el flujo completando varias interacciones, evaluando tanto la precisión de las respuestas del GPT como la funcionalidad de los botones de interacción. Invita a los usuarios a probar preguntando: "Mi perro tiene dos días sin querer comer y está vomitando", para recibir respuestas y verificar si las opciones de interacción funcionan correctamente. Sin embargo, recuerda personalizar cualquier mensaje automatizado conforme a la sensibilidad de los usuarios.

[🡡 volver al inicio](#tabla-de-contenido)

## Envío de Contacto en Emergencias Veterinarias vía WhatsApp

### ¿Cómo integrar un contacto en el flujo de emergencias del bot de WhatsApp?

Al construir un bot para atención a emergencias en WhatsApp, uno de los retos es garantizar que el usuario pueda contactar rápidamente una línea de asistencia cuando detecte una situación crítica. Para ello, podemos implementar un flujo que permita enviar la información de contacto directamente desde el bot. Te explicaremos cómo hacerlo de manera detallada y eficiente.

### ¿Cómo configurar el flujo inicial en WhatsApp Service?

El primer paso para integrar un contacto en nuestro bot es configurar WhatsApp Service para enviar un tipo especial de mensaje: un contacto. Esto se logra mediante el siguiente esquema:

1. Configuración inicial:

   - Inicia sesión en tu cuenta de WhatsApp y accede a la sección de configuración de servicios.

2. Creación de lógica para enviar contacto:

   - Usa la función Sync junto con Send Contact Message.
   - Define el destinatario y el contacto que recibirán el mensaje.

3. Uso de Axios para la lógica:

   - Implementa la lógica con Axios dentro de un bloque try-catch para manejar posibles errores.
   - Modifica la estructura esencial para enviar mensajes del tipo "Contact".

     ```javascript
     try {
       // Lógica para enviar contacto
       const response = await axios.post("URL_DEL_SERVICIO", {
         to: "NÚMERO_DESTINATARIO",
         type: "contacts",
         contacts: [
           {
             name: { first_name: "Veterinaria" },
             phones: [{ number: "123456789" }],
             emails: [{ address: "contacto@veterinaria.com" }],
           },
         ],
       });
       console.log(response.data);
     } catch (error) {
       console.error("Error al enviar contacto:", error);
     }
     ```

### ¿Cómo personalizar el manejador de mensajes?

Una vez configurado el flujo para enviar el contacto, es crucial adaptarlo en el Message Handle, donde se gestiona la lógica de las interacciones.

1. Definir la función para enviar contacto:

   - Crea una función asíncrona que maneje la acción de enviar un contacto cuando se detecte una emergencia.

2. Estructura del contacto:

   - Define todos los elementos de información que formarán parte del contacto, como la organización, teléfonos, y correos electrónicos.

3. Implementación en el flujo:

   - Usa await llamado a WhatsAppService.sendContactMessage para enviar el objeto contacto previamente creado.

     ```javascript
     async function sendContact(user) {
       const contacto = {
         name: { first_name: "Veterinaria Emergencia" },
         phones: [{ number: "123456789" }],
         emails: [{ address: "emergencia@veterinaria.com" }],
       };
       await WhatsAppService.sendContactMessage(user, contacto);
     }
     ```

### ¿Cómo mejorar la interacción del usuario con el menú del bot?

Para una experiencia de usuario fluida, el menú del bot debe ser intuitivo y funcional.

1. Personalización de mensajes:

   - Ajusta el texto de las opciones en el menú para que sea más accesible y claro para el usuario, por ejemplo, "Realiza una pregunta acerca de tu mascota".

2. Incorporación de casos de emergencia:

   - Asegúrate de que las opciones del menú contemplen un caso para emergencias. Implementa un manejo cuidadoso de mayúsculas y minúsculas para evitar errores.

     ```javascript
     switch (opcionSeleccionada.toLowerCase()) {
       case "consulta":
         // lógica para consultas generales
         break;
       case "emergencia":
         // llamado a la función para envío de contacto
         sendContact(usuario);
         break;
       // otras opciones
     }
     ```

### ¿Qué errores comunes podemos encontrar al implementar este flujo?

Al configurar este flujo, es esencial tener cuidado con:

- **Correspondencia de texto:** Asegúrate de que la mayor parte de la lógica utilice IDs u unificados, ya que las discrepancias en el caso pueden causar errores.
- **Manejo de errores:** Implementa bloques try-catch para capturar y manejar excepciones.
- **Revisión y pruebas:** Antes de su despliegue, prueba el flujo para asegurarte de que funciona correctamente, especialmente verificando si los mensajes de emergencia se envían de manera adecuada.

[🡡 volver al inicio](#tabla-de-contenido)

## Validación de Menú en WhatsApp con IDs Estables

### ¿Cómo se mejora la validación de opciones en un menú interactivo?

La validación de opciones de menú es esencial para la fluidez de las aplicaciones y servicios interactivos, como los chatbots. En lugar de validar las opciones por un texto que puede cambiar o tener variaciones en mayúsculas, una práctica más robusta es utilizar un ID para cada opción. Este ID es inmutable y descriptivo, asegurando un estándar firme en las interacciones del menú.

### ¿Qué son las IDs y cómo se utilizan?

- **IDs:** Son identificadores únicos que no cambian, utilizados para determinar de manera inequívoca la acción que se desea ejecutar.
- **Implementación:** En lugar de un nombre que podría cambiar, como “Emergencia”, utiliza opciones como “Opción1” para “Agendar”, o nombres descriptivos según la acción específica.

```javascript
if (button.ID === "Opción1") {
  // Lógica para Agendar
}
```

### ¿Cómo se envía una ubicación usando la API de WhatsApp?

Enviar la ubicación exacta de un establecimiento a través de un chatbot en WhatsApp mejora la experiencia del usuario al brindar información precisa y útil. Este proceso requiere integrar varios elementos dentro del código.

#### ¿Cuáles son los elementos necesarios para enviar una ubicación?

- **Latitud y Longitud:** Coordinadas geográficas que sitúan el lugar específico.
- **Nombre:** Un título claro de la ubicación, como “Platzi Medellín”.
- **Dirección:** Detalles de la ubicación, incluyendo calle, número y región.

```javascript
const latitud = 6.2071;
const longitud = -75.574607;
const nombre = "Platzi Medellín";
const direccion = "Carrera 43A, Número 5A-113, El Poblado Medellín, Antioquia";
```

### ¿Cómo se construye el servicio de envío de ubicación?

La lógica del servicio utiliza Axios para realizar solicitudes HTTP, manejando errores con bloques try-catch para asegurar que cualquier falla sea fácilmente identificable y solucionada.

```javascript
async function sendLocationMessage(user, latitud, longitud, nombre, direccion) {
  try {
    await axios.post("https://api.whatsapp.com/send", {
      to: user,
      message_type: "location",
      location: {
        latitude: latitud,
        longitude: longitud,
        name: nombre,
        address: direccion,
      },
    });
  } catch (error) {
    console.error("Error al enviar la ubicación:", error);
  }
}
```

### ¿Cómo completar y probar la integración del menú con WhatsApp?

Una vez que todo está configurado, es crucial conectar la lógica dentro del menú, asegurando que la opción correcta envíe la información precisa al usuario.

### Implementación en el menú de opciones

Para la opción específica de ubicación, configura la acción del menú para enviar la información necesaria al usuario:

```javascript
await sendLocationMessage(user, latitud, longitud, nombre, direccion);
```

### Prueba de la aplicación

Procede a iniciar el bot en WhatsApp y verifica que el flujo funcione correctamente. Al seleccionar "ubicación", se debería mostrar el mapa con las coordenadas proporcionadas. El objetivo es que el usuario pueda visualizar e interactuar con la ubicación desde la aplicación.

La mejora continua de estos servicios y el uso de prácticas recomendadas asegura una experiencia de usuario más fluida y eficiente, algo fundamental para el éxito de las aplicaciones interactivas en plataformas como WhatsApp.

[🡡 volver al inicio](#tabla-de-contenido)

## Uso de Variables de Entorno y Mejora de Código en WhatsApp Service

En el mundo del desarrollo de software, evitar la repetición de código es una práctica clave que mejora la eficiencia y escalabilidad de las aplicaciones. Al unificar lógicas repetitivas y trabajar con un código centralizado, reducimos los riesgos de errores y facilitamos el mantenimiento. En esta guía, exploraremos cómo aplicar estas mejores prácticas al interactuar con la API de WhatsApp, haciendo el sistema más sencillo y eficiente.

### ¿Cómo comenzamos organizando nuestro código?

Una buena organización del código es esencial para mantener la coherencia y facilitar futuras actualizaciones. Vamos a crear una estructura dedicada en nuestro servicio que encapsulará la lógica relacionada con las solicitudes HTTP.

1. **Crear una carpeta específica:** Dentro de la sección de services, crea una nueva carpeta llamada httprequests. Esta será la ubicación donde centralizaremos la lógica de nuestras solicitudes.

2. **Desarrollar un nuevo archivo:** Dentro de httprequests, genera un archivo llamado sendToWhatsApp.js. Aquí consolidaremos el código de las solicitudes a la API.

3. **Unificar lógicas repetitivas:** Dentro de este archivo, trasladaremos la lógica repetida desde distintas partes del código, asegurando que el envío de mensajes se maneje desde un solo lugar.

### ¿Qué elementos básicos necesitamos en el nuevo archivo?

En nuestro archivo sendToWhatsApp, seguiremos un procedimiento metódico para asegurar que se encapsulen correctamente las funcionalidades necesarias para manejar las solicitudes.

- **Importaciones esenciales:** Importar Axios y nuestro módulo config para manejar las variables de entorno de manera eficiente.

  ```javascript
  import axios from "axios";
  import config from "../config"; // Asegúrate de que apunta a la ubicación correcta
  ```

- **Constante baseURL e Headers:** Define el baseURL necesario y el headers que incluirá la autorización, usando variables de entorno para mayor flexibilidad.

  ```javascript
  const baseURL = config.baseURL; // Esta se puede definir en las variables de entorno
  const headers = {
    authorization: `Bearer ${config.apiKey}`,
  };
  ```

- **Manejo de solicitudes con try-catch:** Implementa un bloque try-catch para gestionar errores y asegurar que el flujo del programa sea robusto ante fallos.

  ```javascript
  const sendToWhatsApp = async (data) => {
    try {
      const response = await axios({
        method: "post",
        url: baseURL,
        headers: headers,
        data: data,
      });
      return response.data;
    } catch (error) {
      console.error("Error sending message:", error);
    }
  };
  ```

### ¿Cómo actualizamos el servicio de WhatsApp para utilizar esta lógica?

El siguiente paso es actualizar el servicio existente para que se beneficie de nuestra nueva estructura lógica. Esto no solo mejora la claridad del código, sino que también agiliza futuras modificaciones.

1. **Eliminar la lógica redundante:** Quita los bloques de código redundantes de tus servicios existentes.

2. **Utilizar la función centralizada:** Ajusta las funciones en WhatsApp Service para que usen sendToWhatsApp.

   ```javascript
   // Ejemplo de uso en otro servicio
   const data = {
     product: "WhatsApp",
     recipient: "recipientNumber",
     text: "textMessage",
   };

   await sendToWhatsApp(data);
   ```

3. **Simplificación y claridad:** Observa cómo se simplifica el código en WhatsApp Service, haciendo más fácil de leer y mantener.

Al implementar estos cambios, nuestro código no solo se vuelve más claro y eficiente, sino que también aumenta en mantenibilidad. Los desarrolladores mantienen un flujo constante en las actualizaciones del sistema, mitigando potenciales errores relacionados con cambios de última hora en las URLs o tokens de autenticación.

Adopta este enfoque proactivo en tu desarrollo y verá cómo tus aplicaciones se vuelven más robustas y fáciles de mantener. ¡Continúa mejorando y explorando nuevas formas de optimizar el código!

[🡡 volver al inicio](#tabla-de-contenido)

## Despliegue de Bots de WhatsApp en Railway con Integración de GitHub

### ¿Cómo llevar a producción un bot de WhatsApp?

Llevar tu bot de WhatsApp a producción es un paso crucial para permitir que cualquier usuario interactúe con él. En este proceso, es vital revisar detalladamente el flujo, ajustar los textos y la información y guardar todo en un repositorio en la nube. Este enfoque no solo facilita el despliegue, sino que también asegura que esté listo para interactuar con la API de Meta de manera eficiente.

### ¿Qué plataformas son ideales para el despliegue?

Railway es una excelente opción para desplegar tu bot de manera rápida y sin complicaciones. Esta plataforma permite un fácil escalado con el tiempo y se conecta fácilmente con tu GitHub para desplegar directamente desde tus repositorios.

Otras opciones incluyen:

- Heroku
- Servicios en la nube de Clover
- Google Cloud
- Amazon Web Services (AWS)

La elección de la plataforma debe basarse en tu comodidad y los requisitos específicos de tu proyecto.

### ¿Cómo gestionar las variables de entorno?

Uno de los aspectos vitales al llevar a producción es la gestión de variables de entorno. Estas permiten manejar información sensible y parámetros cambiantes sin alterar el código fuente. Algunas de las variables esenciales a configurar son:

- WEBHOOK_VERIFY_TOKEN: Un token único para verificar webhooks.
- API_TOKEN: Proporcionado por Meta para autenticar la API.
- BUSINESS_FONT: El ID de tu negocio que se vincula al número de teléfono.
- BASE_URL: La URL base donde se desplegará la aplicación.

Configurar correctamente estas variables garantiza que cualquier cambio futuro sea sencillo y directo, sin tocar el código fuente.

### ¿Cómo asegurar que el despliegue funcione correctamente?

#### Verificación de URL

Una vez hecho el despliegue, obtendrás una URL única. Aunque esta no será pública, es esencial para la comunicación con la API de Meta. Para verificar que todo funcione:

1. Abre la URL en tu navegador para validar el mensaje configurado.
2. Ingresa a la URL de Webhook para asegurarte de que las conexiones sean exitosas, aunque recibas un mensaje de error, lo cual es normal si no estás autorizado para ver la información directamente.

#### Configuración en Meta

Lleva la URL a la plataforma de Meta y ajústala en la configuración de webhooks. Si todo está configurado correctamente, la conexión será verificada, confirmando que el servidor está funcionando.

##### ¿Cómo manejar cambios y ajustes tras el despliegue?

Trabajar directamente desde la nube implica que los cambios ya no se reflejan inmediatamente en tu entorno local. En su lugar, se deben subir a GitHub, desencadenando un nuevo despliegue. Estos son los pasos a seguir cuando necesitas realizar un cambio:

1. Realiza las modificaciones necesarias en tu archivo package.json, asegurando que la entrada sea adecuada para producción.
2. Utiliza comandos como git add, git commit y git push para guardar y subir los cambios.
3. Observa el despliegue automático en Railway y verifica los logs para asegurarte de que no existen errores.

Este flujo asegura que tu aplicación siempre esté actualizada y que los cambios se implementen de manera consistente.

##### ¿Cómo verificar el funcionamiento del bot después del despliegue?

Finalmente, es importante probar las funcionalidades de tu bot una vez desplegado en producción para asegurarte de que todo funcione como se espera:

- Envía un mensaje inicial para verificar el inicio del flujo.
- Realiza diferentes consultas para comprobar la conexión con servicios como ChatGPT.
- Valida funciones clave como las interacciones de usuario con recomendaciones específicas o respuestas de emergencia.

Al completar estas pruebas, garantizas que tu bot no solo esté operativo, sino que ofrezca una experiencia de usuario fluida y eficiente.

[🡡 volver al inicio](#tabla-de-contenido)

## Publicación y configuración de aplicaciones con API de WhatsApp

### ¿Cómo publicar una aplicación en el dashboard de Meta?

El paso crucial para que una aplicación esté disponible para cualquier persona es publicarla en el dashboard de Meta. Este proceso incluye varias consideraciones, como agregar el número de teléfono a utilizar y establecer métodos de pago, dado que WhatsApp ofrece un nivel gratuito que, una vez superado, requiere un pago. A continuación, se detallan los pasos fundamentales para completar la publicación de la aplicación.

### ¿Cuáles son los pasos para configurar el API de WhatsApp?

1. Agregar un número de teléfono:

   - Iniciar con un número de pruebas para luego agregar uno nuevo.
   - Asegúrese de que el número no esté vinculado a WhatsApp. De ser así, cierre todas las sesiones y elimine la cuenta y la aplicación de WhatsApp.
   - Complete la verificación del número. Meta corrobora que el número no esté activo en ninguna cuenta de WhatsApp.

2. Configuración de verificación:

   - Espere recibir un mensaje de texto de verificación en el número proporcionado.
   - Una vez recibido, ingrese el código de verificación para activar el número en el sistema de Meta.

3. Elección de categoría y descripción:

   - Seleccione una categoría para su aplicación, como educación o productividad.
   - Aunque opcional inicialmente, se sugiere completar la descripción de la aplicación posteriormente.

### ¿Cómo configurar métodos de pago adecuados?

Para asegurar la continuidad del servicio una vez superado el nivel gratuito, es esencial configurar un método de pago:

- Dentro de los settings, bajo payment settings:
  - Seleccione el país y asegúrese del timezone correcto.
  - Establezca un método de pago, preferiblemente una tarjeta de débito o crédito.
  - Meta podría realizar un cargo aleatorio en centavos como verificación del método de pago.

### ¿Qué otros aspectos administrativos se deben considerar?

1. Nombre y política de privacidad:

   - Asegúrese de que el nombre asignado al número cumpla con las políticas de Meta.
   - Revise el namespace y otras configuraciones básicas de la aplicación.
   - Adherirse a la política de privacidad y los términos de uso de Meta.

2. Verificación avanzada de Meta:

   - Para obtener la verificación de Meta y acceder a funciones avanzadas, es necesaria una verificación adicional que puede requerir mostrar pruebas de que su empresa es real.

### ¿Cómo se configuran las cuentas de WhatsApp Manager y las variables necesarias?

- Configuración en WhatsApp Manager:

  - Verifique que el número agregado esté activado y tenga un quality rating alto para poder comenzar conversaciones.
  - Establezca elementos visuales como la foto de perfil y la descripción dentro del WhatsApp Manager.

- Variables de entorno y tokens:

  - Actualice las variables de entorno de su aplicación para configurar el business phone y generar un API token permanente.
  - Cree un usuario de sistema con todos los privilegios para manejar el token que no expira y asegúrese de guardarlo de manera segura.

### ¿Cómo realizar la prueba de la aplicación con los cambios implementados?

Llega el momento crítico: probar la aplicación con las configuraciones en producción:

1. Inicializar la aplicación:

   - Verifique que todos los despliegues se hayan completado sin errores y configure la URL de inicio.
   - Pruebe la interactividad del bot enviando mensajes e inicie conversaciones usando los números configurados.

2. Monitorización de errores:

   - Si enfrenta errores de solicitud inválida, revise los permisos de token y otras configuraciones del sistema.

3. Pruebas adicionales y organización:

   - Integre lógica adicional según sea necesario para mantener el flujo completo de información en la aplicación.

Estos pasos detallados aseguran que su aplicación esté lista para operar de manera eficiente y alcance a un público masivo. Siempre es posible seguir utilizando números de prueba para nuevas aplicaciones, lo que permite mantener el entorno de producción estable sin interrupciones al experimentar.

[🡡 volver al inicio](#tabla-de-contenido)
